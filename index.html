<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crush –†–∞–∫–µ—Ç–∞ –ö–∞–∑–∏–Ω–æ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="text/javascript">
        // --- Game State Variables ---
        let balance = 1000; // –ù–∞—á–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å (‚ÇΩ)
        let level = 1;
        let xp = 0;
        let passiveWorkersData = {}; // { Misha: { owned: true, lastIncomeTime: number } }
        let jobCooldowns = {}; // { level: timestamp }
        let questProgress = {
            wins: 0, // –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Å–ø–µ—à–Ω—ã—Ö –∫—ç—à–∞—É—Ç–æ–≤ (–¥–ª—è —Å—Ç–∞—Ä—ã—Ö –∫–≤–µ—Å—Ç–æ–≤)
            completed: {} // { questId: true }
        };

        const XP_PER_GAME = 1; // 1 XP –∑–∞ –∏–≥—Ä—É
        const STORAGE_KEY = 'crushGameData'; // –ö–ª—é—á –¥–ª—è localStorage
        const MAX_LEVEL = 50; // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å
        
        let betAmount = 10;
        let currentMultiplier = 1.00;
        let crashPoint = 0;
        let gameState = 'IDLE'; // IDLE, RUNNING, CASHED_OUT, CRASHED
        let animationFrameId = null;
        let gameStartTime = 0;
        let isGameStarting = false;
        
        let currentView = 'GAME'; // 'GAME' or 'WORK'

        // --- Configuration ---

        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ä—É—á–Ω—ã—Ö —Ä–∞–±–æ—Ç
        const MANUAL_JOBS = [
            { level: 1, name: '–®—É–ª–ª–µ—Ä', salary: 120, xpReward: 2, cooldown: 59000, description: '–ë—ã—Å—Ç—Ä—ã–π, –Ω–æ –º–∞–ª–µ–Ω—å–∫–∏–π –¥–æ—Ö–æ–¥. –£—Ä. 1+' }, // 59 seconds, 2 XP
            { level: 5, name: '–®–∞—Ö—Ç—ë—Ä', salary: 400, xpReward: 4, cooldown: 120000, description: '–¢—è–∂–µ–ª—ã–π —Ç—Ä—É–¥, —Ö–æ—Ä–æ—à–∞—è –∑–∞—Ä–ø–ª–∞—Ç–∞. –£—Ä. 5+' }, // 2 minutes, 4 XP
            { level: 10, name: 'Coming Soon', salary: 0, xpReward: 0, cooldown: 9999999, description: '–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ. –£—Ä. 10+' }
        ];
        
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–∞—Å—Å–∏–≤–Ω—ã—Ö —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤ (–í–ö–õ–Æ–ß–ê–Ø –í–ê–ù–Æ)
        const PASSIVE_WORKERS = [
            { id: 'Misha', name: '–ú–∏—à–∞', incomePerSecond: 2, price: 3500, description: '–ù–∞–¥–µ–∂–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫. 2 ‚ÇΩ/—Å–µ–∫' },
            { id: 'Vanya', name: '–í–∞–Ω—è', incomePerSecond: 59, price: 12000, description: '–ö—Ä—É–ø–Ω—ã–π –∏–Ω–≤–µ—Å—Ç–æ—Ä. 59 ‚ÇΩ/—Å–µ–∫' }
        ];

        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–≤–µ—Å—Ç–æ–≤ (–ó–∞–¥–∞–Ω–∏—è)
        const QUESTS = [
            // –ö–≤–µ—Å—Ç—ã, –æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–µ –Ω–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –£—Ä–æ–≤–Ω—è
            { id: 1, name: '–ù–æ–≤–∏—á–æ–∫', type: 'level', requirement: 2, reward: 500, xpReward: 12, unlockLevel: 1, description: '–î–æ—Å—Ç–∏–≥–Ω–∏—Ç–µ –£—Ä–æ–≤–Ω—è 2.' },
            { id: 2, name: '–ü–µ—Ä–≤—ã–π –†—ã–≤–æ–∫', type: 'level', requirement: 4, reward: 1500, xpReward: 12, unlockLevel: 2, description: '–î–æ—Å—Ç–∏–≥–Ω–∏—Ç–µ –£—Ä–æ–≤–Ω—è 4.' },
            { id: 3, name: '–í –°–µ—Ä–µ–¥–∏–Ω—É', type: 'level', requirement: 7, reward: 4500, xpReward: 12, unlockLevel: 5, description: '–î–æ—Å—Ç–∏–≥–Ω–∏—Ç–µ –£—Ä–æ–≤–Ω—è 7.' },
            { id: 4, name: '–ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π', type: 'level', requirement: 12, reward: 3500, xpReward: 12, unlockLevel: 9, description: '–î–æ—Å—Ç–∏–≥–Ω–∏—Ç–µ –£—Ä–æ–≤–Ω—è 12.' },
            { id: 5, name: '–ù–∞ –ü–æ–¥—Ö–æ–¥–µ', type: 'level', requirement: 16, reward: 5700, xpReward: 12, unlockLevel: 13, description: '–î–æ—Å—Ç–∏–≥–Ω–∏—Ç–µ –£—Ä–æ–≤–Ω—è 16.' },
            { id: 6, name: '–§–∏–Ω–∏—à–Ω–∞—è –ü—Ä—è–º–∞—è', type: 'level', requirement: 20, reward: 6600, xpReward: 24, unlockLevel: 15, description: '–î–æ—Å—Ç–∏–≥–Ω–∏—Ç–µ –£—Ä–æ–≤–Ω—è 20.' },
            
            // –ö–≤–µ—Å—Ç—ã, –æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–µ –Ω–∞ –ø–æ–±–µ–¥–∞—Ö –≤ –∫—Ä–∞—à-–∏–≥—Ä–µ (–û—Ç–∫—Ä—ã–≤–∞—é—Ç—Å—è –Ω–∞ –£—Ä–æ–≤–Ω–µ 20)
            { id: 101, name: '–ü–µ—Ä–≤–∞—è –°—Ç—É–ø–µ–Ω—å', type: 'wins', requirement: 20, reward: 13800, xpReward: 0, unlockLevel: 20, description: '–í—ã–∏–≥—Ä–∞—Ç—å –≤ –∫—Ä–∞—à-–∏–≥—Ä–µ 20 —Ä–∞–∑.' },
            { id: 102, name: '–û–ø—ã—Ç–Ω—ã–π –ò–≥—Ä–æ–∫', type: 'wins', requirement: 45, reward: 49000, xpReward: 0, unlockLevel: 20, description: '–í—ã–∏–≥—Ä–∞—Ç—å –≤ –∫—Ä–∞—à-–∏–≥—Ä–µ 45 —Ä–∞–∑.' }
        ];


        // UI Elements
        let balanceElement, levelElement, xpElement, multiplierElement, betInputElement, playButton, gameArea, messageBox, rocketIcon, statusText;
        let gameTabButton, workTabButton, workListElement;

        // --- Utility Functions ---

        /** –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤–µ—Å—å –∏–≥—Ä–æ–≤–æ–π —Å—Ç–µ–π—Ç –≤ localStorage */
        const saveState = () => {
            try {
                const dataToStore = {
                    balance: balance,
                    level: level,
                    xp: xp,
                    passiveWorkersData: passiveWorkersData,
                    jobCooldowns: jobCooldowns,
                    questProgress: questProgress
                };
                localStorage.setItem(STORAGE_KEY, JSON.stringify(dataToStore));
            } catch (e) {
                console.error("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ localStorage:", e);
            }
            updateUI();
        };

        /** –ó–∞–≥—Ä—É–∂–∞–µ—Ç –≤–µ—Å—å –∏–≥—Ä–æ–≤–æ–π —Å—Ç–µ–π—Ç –∏–∑ localStorage */
        const loadState = () => {
            try {
                const storedData = localStorage.getItem(STORAGE_KEY);
                if (storedData) {
                    const data = JSON.parse(storedData);
                    balance = data.balance || 1000;
                    level = data.level || 1;
                    xp = data.xp || 0;
                    passiveWorkersData = data.passiveWorkersData || {};
                    jobCooldowns = data.jobCooldowns || {}; 
                    questProgress = data.questProgress || { wins: 0, completed: {} };
                    if (!questProgress.completed) questProgress.completed = {};
                    
                    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                    if (balance < 10) {
                        balance = 1000;
                        messageBox.textContent = "–ë–∞–ª–∞–Ω—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –¥–æ 1000 ‚ÇΩ.";
                        messageBox.classList.remove('hidden');
                        setTimeout(() => { messageBox.classList.add('hidden'); }, 3000);
                        saveState(); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –±–∞–ª–∞–Ω—Å
                    }
                    
                    // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –¥–æ—Ö–æ–¥, –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã–π –≤ –æ—Ñ–ª–∞–π–Ω–µ
                    processOfflineIncome();
                    
                    return true; // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ
                }
            } catch (e) {
                console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–∑ localStorage:", e);
            }
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è, –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç
            balance = 1000;
            level = 1;
            xp = 0;
            passiveWorkersData = {};
            jobCooldowns = {};
            questProgress = { wins: 0, completed: {} };
            messageBox.textContent = "–ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å. –ù–∞—á–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å 1000 ‚ÇΩ, –£—Ä. 1.";
            messageBox.classList.remove('hidden');
            setTimeout(() => { messageBox.classList.add('hidden'); }, 3000);
            return false; // –ù–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
        };

        /** –í—ã—á–∏—Å–ª—è–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–π XP –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —É—Ä–æ–≤–Ω—è. */
        const getRequiredXP = (currentLevel) => {
            if (currentLevel >= MAX_LEVEL) {
                return Infinity; // XP –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–≤–µ–Ω—å
            }
            // –§–æ—Ä–º—É–ª–∞: 20 + (—Ç–µ–∫—É—â–∏–π_—É—Ä–æ–≤–µ–Ω—å - 1) * 5
            return 20 + (currentLevel - 1) * 5; 
        };

        /** –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —á–∏—Å–ª–æ –≤ –≤–∞–ª—é—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Å —Å–∏–º–≤–æ–ª–æ–º ‚ÇΩ */
        const formatCurrency = (amount) => {
            return `${Math.floor(amount).toLocaleString('ru-RU')} ‚ÇΩ`;
        };
        
        /** –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –º–Ω–æ–∂–∏—Ç–µ–ª—å */
        const formatMultiplier = (multiplier) => {
            return multiplier.toFixed(2) + 'x';
        };
        
        /** –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —Ä–∞–∑–Ω–∏—Ü—É –≤–æ –≤—Ä–µ–º–µ–Ω–∏ (–¥–ª—è –∫—É–ª–¥–æ—É–Ω–æ–≤) */
        const formatTimeDifference = (ms) => {
            if (ms <= 0) return '–ì–æ—Ç–æ–≤';
            const totalSeconds = Math.ceil(ms / 1000);
            const minutes = Math.floor(totalSeconds / 60);
            const seconds = totalSeconds % 60;
            return `${minutes}:${seconds.toString().padStart(2, '0')}`;
        };
        
        /** –ü—Ä–æ–≤–µ—Ä—è–µ—Ç XP –∏ –ø–æ–≤—ã—à–∞–µ—Ç —É—Ä–æ–≤–µ–Ω—å –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ */
        const checkLevelUp = () => {
            let changed = false;
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å
            if (level >= MAX_LEVEL) {
                xp = 0; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º XP, –µ—Å–ª–∏ —É—Ä–æ–≤–µ–Ω—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π
                return false;
            }

            const requiredXP = getRequiredXP(level);
            
            if (xp >= requiredXP) {
                level += 1;
                xp -= requiredXP;
                changed = true;
                
                
                // –ï—Å–ª–∏ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç MAX_LEVEL
                if (level === MAX_LEVEL) {
                    messageBox.textContent = `‚≠ê –î–û–°–¢–ò–ì–ù–£–¢ –ú–ê–ö–°–ò–ú–ê–õ–¨–ù–´–ô –£–†–û–í–ï–ù–¨ (${MAX_LEVEL})! ‚≠ê`;
                    xp = 0; // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º XP –≤ 0
                } else {
                    messageBox.textContent = `üí• –ü–û–ó–î–†–ê–í–õ–Ø–ï–ú! –í—ã –¥–æ—Å—Ç–∏–≥–ª–∏ –£–†–û–í–ù–Ø ${level}!`;
                }
                
                messageBox.classList.remove('hidden');
                setTimeout(() => { messageBox.classList.add('hidden'); }, 3000);

                if (level < MAX_LEVEL && xp >= getRequiredXP(level)) {
                     // –†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –≤—ã–∑–æ–≤, –µ—Å–ª–∏ XP —Ö–≤–∞—Ç–∞–µ—Ç –Ω–∞ –µ—â–µ –æ–¥–∏–Ω —É—Ä–æ–≤–µ–Ω—å
                     return checkLevelUp(); 
                }
            }
            return changed;
        };


        /** –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥–æ—Ö–æ–¥, –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã–π, –ø–æ–∫–∞ –∏–≥—Ä–æ–∫ –±—ã–ª –≤ –æ—Ñ–ª–∞–π–Ω–µ */
        const processOfflineIncome = () => {
            let totalIncome = 0;
            const now = Date.now();
            let passiveWorkersUpdates = {};
            let shouldUpdate = false;
            
            PASSIVE_WORKERS.forEach(worker => {
                const workerData = passiveWorkersData[worker.id];
                if (workerData && workerData.owned && workerData.lastIncomeTime) {
                    const timeElapsedMs = now - workerData.lastIncomeTime;
                    
                    if (timeElapsedMs >= 1000) {
                        const timeElapsedSeconds = Math.floor(timeElapsedMs / 1000);
                        const earned = timeElapsedSeconds * worker.incomePerSecond;
                        
                        totalIncome += earned;
                        
                        passiveWorkersUpdates[worker.id] = { 
                            ...workerData, 
                            lastIncomeTime: workerData.lastIncomeTime + (timeElapsedSeconds * 1000)
                        };
                        shouldUpdate = true;
                    }
                }
            });

            if (totalIncome > 0) {
                balance += totalIncome;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º passiveWorkersData –ª–æ–∫–∞–ª—å–Ω–æ
                for (const id in passiveWorkersUpdates) {
                    passiveWorkersData[id] = passiveWorkersUpdates[id];
                }

                saveState();
                
                messageBox.textContent = `üöÄ –ó–∞ –≤—Ä–µ–º—è –≤–∞—à–µ–≥–æ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è —Ä–∞–±–æ—Ç–Ω–∏–∫–∏ –∑–∞—Ä–∞–±–æ—Ç–∞–ª–∏ ${formatCurrency(totalIncome)}!`;
                messageBox.classList.remove('hidden');
                setTimeout(() => { messageBox.classList.add('hidden'); }, 4000);
            } else if (shouldUpdate) {
                // –ï—Å–ª–∏ –Ω–µ—Ç –¥–æ—Ö–æ–¥–∞, –Ω–æ –≤—Ä–µ–º—è –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å
                 for (const id in passiveWorkersUpdates) {
                    passiveWorkersData[id] = passiveWorkersUpdates[id];
                }
                saveState();
            }
        };

        /** –ü—Ä–∏–º–µ–Ω—è–µ—Ç –ø–∞—Å—Å–∏–≤–Ω—ã–π –¥–æ—Ö–æ–¥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ */
        const applyLivePassiveIncome = () => {
             let totalIncome = 0;
             const now = Date.now();
             let passiveWorkersUpdates = {};
             let shouldUpdate = false;

             PASSIVE_WORKERS.forEach(worker => {
                 const workerData = passiveWorkersData[worker.id];
                 if (workerData && workerData.owned) {
                     // –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ lastIncomeTime —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
                     if (!workerData.lastIncomeTime) {
                         passiveWorkersUpdates[worker.id] = { ...workerData, lastIncomeTime: now };
                         shouldUpdate = true;
                     } else {
                         const timeElapsedMs = now - workerData.lastIncomeTime;
                         if (timeElapsedMs >= 1000) {
                            const timeElapsedSeconds = Math.floor(timeElapsedMs / 1000);
                            const earned = timeElapsedSeconds * worker.incomePerSecond;
                            
                            totalIncome += earned;

                            passiveWorkersUpdates[worker.id] = { 
                                ...workerData, 
                                lastIncomeTime: workerData.lastIncomeTime + (timeElapsedSeconds * 1000)
                            };
                            shouldUpdate = true;
                         }
                     }
                 }
             });

             if (totalIncome > 0) {
                 balance += totalIncome;
                 
                 // –û–±–Ω–æ–≤–ª—è–µ–º passiveWorkersData –ª–æ–∫–∞–ª—å–Ω–æ
                 for (const id in passiveWorkersUpdates) {
                     passiveWorkersData[id] = passiveWorkersUpdates[id];
                 }
                 
                 saveState();
             } else if (shouldUpdate) {
                  // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –≤—Ä–µ–º—è
                  for (const id in passiveWorkersUpdates) {
                      passiveWorkersData[id] = passiveWorkersUpdates[id];
                  }
                  saveState();
             }
        };

        /** –ó–∞–ø—É—Å–∫–∞–µ—Ç —Ü–∏–∫–ª –ø–∞—Å—Å–∏–≤–Ω–æ–≥–æ –¥–æ—Ö–æ–¥–∞ */
        const startPassiveIncomeLoop = () => {
             setInterval(applyLivePassiveIncome, 1000);
        };


        /** –†–µ–Ω–¥–µ—Ä–∏—Ç —Å–ø–∏—Å–æ–∫ —Ä–∞–±–æ—Ç –∏ –∫–≤–µ—Å—Ç–æ–≤ */
        const renderWorkView = () => {
            if (!workListElement) return;

            workListElement.innerHTML = ''; // –û—á–∏—Å—Ç–∫–∞
            const now = Date.now();
            
            // --- 1. –ü–∞—Å—Å–∏–≤–Ω—ã–µ –†–∞–±–æ—Ç–Ω–∏–∫–∏ ---
            const passiveTitle = document.createElement('h3');
            passiveTitle.className = 'text-lg font-bold text-indigo-400 mb-3 mt-4 border-b border-gray-700 pb-1';
            passiveTitle.textContent = '–ü–∞—Å—Å–∏–≤–Ω—ã–µ –†–∞–±–æ—Ç–Ω–∏–∫–∏ (–ö—É–ø–∏—Ç—å 1 —Ä–∞–∑)';
            workListElement.appendChild(passiveTitle);

            PASSIVE_WORKERS.forEach(worker => {
                const workerData = passiveWorkersData[worker.id] || { owned: false };
                const isOwned = workerData.owned;
                const canAfford = balance >= worker.price;
                const isDisabled = isOwned || !canAfford;

                const buttonText = isOwned 
                    ? `–†–∞–±–æ—Ç–∞–µ—Ç: ${worker.incomePerSecond} ‚ÇΩ/—Å–µ–∫` 
                    : `–ö—É–ø–∏—Ç—å (${formatCurrency(worker.price)})`;

                const buttonClass = isOwned 
                    ? 'bg-green-700 text-white cursor-default'
                    : (isDisabled 
                        ? 'bg-red-900 text-red-300 cursor-not-allowed'
                        : 'bg-yellow-600 hover:bg-yellow-700 active:bg-yellow-800');

                const workerCard = document.createElement('div');
                workerCard.className = 'flex items-center justify-between bg-gray-700 p-4 rounded-lg shadow-md mb-3';
                workerCard.innerHTML = `
                    <div>
                        <p class="text-lg font-bold text-white">${worker.name}</p>
                        <p class="text-sm text-gray-400">${worker.description}</p>
                    </div>
                    <div class="text-right">
                        <button id="worker-btn-${worker.id}" 
                                class="worker-button px-4 py-2 text-sm rounded-lg font-semibold text-white transition ${buttonClass}"
                                data-id="${worker.id}"
                                ${isDisabled ? 'disabled' : ''}>
                            ${buttonText}
                        </button>
                    </div>
                `;
                workListElement.appendChild(workerCard);
            });
            
            // Attach purchase listener
            document.querySelectorAll('.worker-button').forEach(button => {
                // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π —Å–ª—É—à–∞—Ç–µ–ª—å, –µ—Å–ª–∏ –æ–Ω –±—ã–ª
                button.removeEventListener('click', handleWorkerPurchase);
                if (!button.disabled && button.dataset.id) {
                    button.addEventListener('click', handleWorkerPurchase);
                }
            });


            // --- 2. –†—É—á–Ω—ã–µ –†–∞–±–æ—Ç—ã (–ö—É–ª–¥–∞—É–Ω) ---
            const manualTitle = document.createElement('h3');
            manualTitle.className = 'text-lg font-bold text-indigo-400 mb-3 mt-6 border-b border-gray-700 pb-1';
            manualTitle.textContent = '–†—É—á–Ω—ã–µ –†–∞–±–æ—Ç—ã (–ö—É–ª–¥–∞—É–Ω)';
            workListElement.appendChild(manualTitle);

            MANUAL_JOBS.forEach(job => {
                const isLocked = level < job.level; 
                
                const lastRun = jobCooldowns[job.level] || 0;
                const timeRemaining = lastRun + job.cooldown - now;
                const isReady = timeRemaining <= 0;
                
                const isDisabled = isLocked || !isReady || job.salary === 0; 
                
                const buttonText = isLocked 
                    ? `–¢—Ä–µ–±—É–µ—Ç—Å—è –£—Ä. ${job.level}`
                    : (job.salary === 0 ? job.name : (isReady ? '–í–∑—è—Ç—å –†–∞–±–æ—Ç—É' : formatTimeDifference(timeRemaining)));

                const buttonClass = isLocked 
                    ? 'bg-red-900 text-red-300 cursor-not-allowed'
                    : (isDisabled 
                        ? 'bg-gray-600 cursor-not-allowed'
                        : 'bg-indigo-600 hover:bg-indigo-700 active:bg-indigo-800');

                const levelClass = job.level <= 5 ? 'text-green-400' : 'text-yellow-400';
                
                const jobCard = document.createElement('div');
                jobCard.className = 'flex items-center justify-between bg-gray-700 p-4 rounded-lg shadow-md mb-3';
                jobCard.innerHTML = `
                    <div>
                        <p class="text-lg font-bold text-white">${job.name} (–£—Ä. ${job.level})</p>
                        <p class="text-sm ${levelClass}">–ó–∞—Ä–ø–ª–∞—Ç–∞: ${formatCurrency(job.salary)} <span class="text-xs text-indigo-300 ml-2">+${job.xpReward} XP</span></p>
                    </div>
                    <div class="text-right">
                        ${!isLocked ? `<p class="text-xs text-gray-400 mb-1">–ö—É–ª–¥–∞—É–Ω: ${formatTimeDifference(job.cooldown)}</p>` : `<p class="text-xs text-red-400 mb-1">–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ</p>`}
                        <button id="job-btn-${job.level}" 
                                class="manual-job-button px-4 py-2 text-sm rounded-lg font-semibold text-white transition ${buttonClass}"
                                data-level="${job.level}"
                                ${isDisabled ? 'disabled' : ''}>
                            ${buttonText}
                        </button>
                    </div>
                `;
                workListElement.appendChild(jobCard);
            });
            
            // Re-attach event listeners
            document.querySelectorAll('.manual-job-button').forEach(button => {
                button.removeEventListener('click', handleJobClick);
                if (!button.disabled) {
                    button.addEventListener('click', handleJobClick);
                }
            });
            
            // --- 3. –ö–≤–µ—Å—Ç—ã ---
            const questTitle = document.createElement('h3');
            questTitle.className = 'text-lg font-bold text-indigo-400 mb-3 mt-6 border-b border-gray-700 pb-1';
            questTitle.textContent = '–ö–≤–µ—Å—Ç—ã (–ó–∞–¥–∞–Ω–∏—è)';
            workListElement.appendChild(questTitle);
            
            // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –∫–≤–µ—Å—Ç–æ–≤
            QUESTS.forEach(quest => {
                const isCompleted = questProgress.completed[quest.id];
                
                let currentProgress;
                let isReadyToClaim;
                let progressText;
                
                // --- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –∫–≤–µ—Å—Ç–∞ ---
                if (quest.type === 'level') {
                    currentProgress = level;
                    isReadyToClaim = currentProgress >= quest.requirement && !isCompleted;
                    progressText = isCompleted 
                        ? '–ó–∞–≤–µ—Ä—à–µ–Ω–æ' 
                        : `–£—Ä. ${currentProgress} / –£—Ä. ${quest.requirement}`;
                } else { // 'wins' type (–ø–æ–±–µ–¥—ã –≤ –∫—Ä–∞—à-–∏–≥—Ä–µ)
                    currentProgress = questProgress.wins;
                    isReadyToClaim = currentProgress >= quest.requirement && !isCompleted;
                    progressText = isCompleted 
                        ? '–ó–∞–≤–µ—Ä—à–µ–Ω–æ' 
                        : `${currentProgress} / ${quest.requirement} –ø–æ–±–µ–¥`;
                }

                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ø–æ —É—Ä–æ–≤–Ω—é
                const isLocked = level < quest.unlockLevel;

                const isDisabled = isLocked || isCompleted || !isReadyToClaim;
                
                const buttonText = isLocked
                    ? `–¢—Ä–µ–±—É–µ—Ç—Å—è –£—Ä. ${quest.unlockLevel}`
                    : (isCompleted 
                        ? '–ù–∞–≥—Ä–∞–¥–∞ –ü–æ–ª—É—á–µ–Ω–∞'
                        : (isReadyToClaim ? '–ó–ê–ë–†–ê–¢–¨ –ù–ê–ì–†–ê–î–£' : '–í –ø—Ä–æ—Ü–µ—Å—Å–µ...'));

                const buttonClass = isLocked
                    ? 'bg-red-900 text-red-300 cursor-not-allowed'
                    : (isCompleted 
                        ? 'bg-green-700 text-white cursor-default'
                        : (isReadyToClaim 
                            ? 'bg-lime-600 hover:bg-lime-700 active:bg-lime-800'
                            : 'bg-gray-600 cursor-not-allowed'));
                
                const rewardText = `${formatCurrency(quest.reward)}${quest.xpReward > 0 ? ` + ${quest.xpReward} XP` : ''}`;

                const questCard = document.createElement('div');
                questCard.className = 'flex items-center justify-between bg-gray-700 p-4 rounded-lg shadow-md mb-3';
                questCard.innerHTML = `
                    <div>
                        <p class="text-lg font-bold text-white">${quest.name}</p>
                        <p class="text-sm text-gray-400">${quest.description}</p>
                        <p class="text-xs text-yellow-400 mt-1">–ù–∞–≥—Ä–∞–¥–∞: ${rewardText}</p>
                    </div>
                    <div class="text-right">
                        <p class="text-xs ${isCompleted ? 'text-green-400' : 'text-yellow-400'} mb-1">${progressText}</p>
                        <button id="quest-btn-${quest.id}" 
                                class="quest-button px-4 py-2 text-sm rounded-lg font-semibold text-white transition ${buttonClass}"
                                data-id="${quest.id}"
                                ${isDisabled ? 'disabled' : ''}>
                            ${buttonText}
                        </button>
                    </div>
                `;
                workListElement.appendChild(questCard);
            });
            
            // Attach quest claim listener
            document.querySelectorAll('.quest-button').forEach(button => {
                button.removeEventListener('click', handleQuestClaim); 
                if (!button.disabled && button.dataset.id) {
                    button.addEventListener('click', handleQuestClaim);
                }
            });
        };

        /** –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ç–µ–∫—É—â–µ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç UI */
        const setView = (view) => {
            currentView = view;
            
            const gameContent = document.getElementById('game-content');
            const workContent = document.getElementById('work-content');
            
            if (currentView === 'GAME') {
                gameContent.classList.remove('hidden');
                workContent.classList.add('hidden');
                gameTabButton.classList.add('border-indigo-500', 'text-white');
                workTabButton.classList.remove('border-indigo-500', 'text-white');
                workTabButton.classList.add('border-transparent', 'text-gray-400');
            } else {
                gameContent.classList.add('hidden');
                workContent.classList.remove('hidden');
                workTabButton.classList.add('border-indigo-500', 'text-white');
                gameTabButton.classList.remove('border-indigo-500', 'text-white');
                gameTabButton.classList.add('border-transparent', 'text-gray-400');
                renderWorkView(); 
            }
        };

        /** –û–±–Ω–æ–≤–ª—è–µ—Ç —ç–ª–µ–º–µ–Ω—Ç—ã UI */
        const updateUI = () => {
            if (!balanceElement) return;

            balanceElement.textContent = formatCurrency(balance);
            const xpBar = document.getElementById('xp-progress-bar');
            
            if (level >= MAX_LEVEL) {
                // –ï—Å–ª–∏ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å
                levelElement.textContent = `${MAX_LEVEL} (MAX)`;
                xpElement.textContent = 'MAX';
                xpBar.style.width = `100%`;
            } else {
                // –û–±—ã—á–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è –∏ XP
                levelElement.textContent = level;
                const xpRequired = getRequiredXP(level);
                xpElement.textContent = `${xp} / ${xpRequired} XP`;
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª–æ—Å—ã XP
                const progress = (xp / xpRequired) * 100;
                xpBar.style.width = `${Math.min(100, progress)}%`;
            }

            betInputElement.value = betAmount;
            
            if (currentView === 'GAME') {
                multiplierElement.textContent = formatMultiplier(currentMultiplier);
                
                rocketIcon.classList.toggle('animate-pulse', gameState === 'RUNNING');
                
                if (gameState === 'IDLE' || gameState === 'CASHED_OUT') {
                    multiplierElement.classList.remove('text-red-500', 'text-yellow-500');
                    multiplierElement.classList.add('text-gray-400');
                    statusText.textContent = '–û–∂–∏–¥–∞–Ω–∏–µ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ä–∞—É–Ω–¥–∞...';
                    
                } else if (gameState === 'RUNNING') {
                    multiplierElement.classList.remove('text-red-500', 'text-gray-400');
                    if (currentMultiplier >= 2.00) {
                        multiplierElement.classList.add('text-yellow-500');
                    } else {
                        multiplierElement.classList.remove('text-yellow-500');
                    }
                    
                    statusText.textContent = '–†–∞–∫–µ—Ç–∞ –ª–µ—Ç–∏—Ç! –ñ–º–∏ –°–¢–û–ü!';
                    
                } else if (gameState === 'CRASHED') {
                    multiplierElement.classList.remove('text-yellow-500', 'text-gray-400');
                    multiplierElement.classList.add('text-red-500');
                    statusText.textContent = `–ö–†–ê–•! x${crashPoint.toFixed(2)}. –í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏ ${formatCurrency(betAmount)}!`;
                }
                
                // –õ–æ–≥–∏–∫–∞ –∫–Ω–æ–ø–∫–∏
                betInputElement.disabled = gameState === 'RUNNING';

                if (gameState === 'RUNNING') {
                    playButton.textContent = '–°–¢–û–ü (x' + currentMultiplier.toFixed(2) + ')';
                    playButton.classList.remove('bg-green-600', 'hover:bg-green-700');
                    playButton.classList.add('bg-red-600', 'hover:bg-red-700');
                    playButton.disabled = false;
                } else {
                    playButton.textContent = '–ò–ì–†–ê–¢–¨';
                    playButton.classList.remove('bg-red-600', 'hover:bg-red-700');
                    playButton.classList.add('bg-green-600', 'hover:bg-green-700');
                    playButton.disabled = isGameStarting || (betAmount > balance || betAmount <= 0);
                }

                if (gameState === 'CASHED_OUT') {
                    const winnings = betAmount * currentMultiplier;
                    messageBox.textContent = `–£—Å–ø–µ—Ö! –í—ã –∑–∞–±—Ä–∞–ª–∏ ${formatCurrency(winnings)} –ø—Ä–∏ x${currentMultiplier.toFixed(2)}!`;
                    messageBox.classList.remove('hidden');
                    setTimeout(() => {
                        messageBox.classList.add('hidden');
                    }, 3000);
                } else if (gameState !== 'IDLE') {
                    messageBox.classList.add('hidden');
                }
            } else if (currentView === 'WORK') {
                renderWorkView();
            }
        };

        // --- Game Logic (Crash) ---

        /** –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –º–Ω–æ–∂–∏—Ç–µ–ª—å –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–æ—à–µ–¥—à–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ */
        const calculateMultiplier = (timeElapsedMs) => {
            const timeSeconds = timeElapsedMs / 1000.0;
            // –ü—Ä–æ—Å—Ç–∞—è –∫—Ä–∏–≤–∞—è —Ä–æ—Å—Ç–∞: 1.0 + (–≤—Ä–µ–º—è ^ 1.5) * 0.15
            return 1.0 + Math.pow(timeSeconds, 1.5) * 0.15;
        };

        /** –û—Å–Ω–æ–≤–Ω–æ–π –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª */
        const gameLoop = (timestamp) => {
            if (gameState !== 'RUNNING') {
                return;
            }

            if (!gameStartTime) {
                gameStartTime = timestamp;
            }

            const timeElapsed = timestamp - gameStartTime;

            currentMultiplier = calculateMultiplier(timeElapsed);

            // –ê–Ω–∏–º–∞—Ü–∏—è —Ä–∞–∫–µ—Ç—ã (–≤–∏–∑—É–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç)
            const visualMultiplier = Math.min(currentMultiplier, 5.00); 
            const travelRange = visualMultiplier - 1.00; 
            const maxRange = 4.00; 
            
            const percentageUp = (travelRange / maxRange) * 80; 
            
            rocketIcon.style.transform = `translateY(${Math.min(0, -percentageUp)}%)`;

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∫—Ä–∞—Ö
            if (currentMultiplier >= crashPoint) {
                endGame('CRASHED');
                return;
            }

            updateUI();

            animationFrameId = requestAnimationFrame(gameLoop);
        };

        /** –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∏–≥—Ä—É */
        const startGame = () => {
            const bet = parseFloat(betInputElement.value);
            
            if (isNaN(bet) || bet <= 0 || bet > balance) {
                messageBox.textContent = '–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Å—Ç–∞–≤–∫–∞. –í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –æ—Ç 1 –¥–æ ' + formatCurrency(balance);
                messageBox.classList.remove('hidden');
                setTimeout(() => { messageBox.classList.add('hidden'); }, 3000);
                return;
            }

            isGameStarting = true;
            playButton.disabled = true;
            statusText.textContent = '–ó–∞–ø—É—Å–∫ —Ä–∞–∫–µ—Ç—ã...';

            rocketIcon.classList.remove('rocket-exploding'); 
            rocketIcon.style.transform = `translateY(0)`; 
            rocketIcon.style.opacity = 1; 

            setTimeout(() => {
                // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–æ—á–∫–∏ –∫—Ä–∞—Ö–∞ (—á–µ–º –º–µ–Ω—å—à–µ r, —Ç–µ–º –≤—ã—à–µ —Ç–æ—á–∫–∞ –∫—Ä–∞—Ö–∞)
                const r = Math.random(); 
                crashPoint = Math.max(1.01, 1 / (1 - r) * 0.07 + 1.0); 
                crashPoint = Math.min(crashPoint, 100.0); // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º

                // –í—ã—á–∏—Ç–∞–µ–º —Å—Ç–∞–≤–∫—É
                balance -= bet;
                saveState(); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–æ–≤—ã–π –±–∞–ª–∞–Ω—Å

                betAmount = bet;
                currentMultiplier = 1.00;
                gameState = 'RUNNING';
                gameStartTime = 0; 
                isGameStarting = false;
                
                updateUI();
                animationFrameId = requestAnimationFrame(gameLoop); 
            }, 1000); 
        };

        /** –ó–∞–≤–µ—Ä—à–∞–µ—Ç –∏–≥—Ä—É */
        const endGame = (reason) => {
            if (animationFrameId) {
                cancelAnimationFrame(animationFrameId);
                animationFrameId = null;
            }
            
            // 1. –ù–∞—á–∏—Å–ª—è–µ–º XP –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º —É—Ä–æ–≤–µ–Ω—å
            if (level < MAX_LEVEL) {
                 xp += XP_PER_GAME;
            }
            checkLevelUp();
            
            if (reason === 'CASHED_OUT') {
                const winnings = betAmount * currentMultiplier;
                balance += winnings; // –î–æ–±–∞–≤–ª—è–µ–º –≤—ã–∏–≥—Ä—ã—à
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –∫–≤–µ—Å—Ç–æ–≤ –Ω–∞ –ø–æ–±–µ–¥—ã
                questProgress.wins += 1;

                gameState = 'CASHED_OUT';
            } else {
                gameState = 'CRASHED';
                rocketIcon.classList.add('rocket-exploding');
                
                setTimeout(() => {
                    rocketIcon.style.opacity = 0; 
                }, 500);
            }

            saveState(); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Å–µ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

            updateUI();
            
            // –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(() => {
                currentMultiplier = 1.00;
                gameState = 'IDLE';
                rocketIcon.style.transform = `translateY(0)`; 
                rocketIcon.style.opacity = 1;
                rocketIcon.classList.remove('rocket-exploding');
                updateUI();
            }, 3000); 
        };

        /** –î–µ–π—Å—Ç–≤–∏–µ –∏–≥—Ä–æ–∫–∞: –∑–∞–±—Ä–∞—Ç—å –≤—ã–∏–≥—Ä—ã—à */
        const cashOut = () => {
            if (gameState === 'RUNNING' && currentMultiplier > 1.00) {
                endGame('CASHED_OUT');
            }
        };
        
        // --- Worker/Job Logic (Work) ---
        
        /** –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ —Ä—É—á–Ω–æ–π —Ä–∞–±–æ—Ç–µ */
        const handleJobClick = (event) => {
            const levelId = parseInt(event.target.dataset.level);
            const job = MANUAL_JOBS.find(j => j.level === levelId);

            if (!job || level < job.level) return; 

            const now = Date.now();
            const lastRun = jobCooldowns[job.level] || 0;
            const timeRemaining = lastRun + job.cooldown - now;

            if (timeRemaining > 0) {
                 messageBox.textContent = `–ü–æ–¥–æ–∂–¥–∏—Ç–µ! –î–æ—Å—Ç—É–ø–Ω–æ —á–µ—Ä–µ–∑ ${formatTimeDifference(timeRemaining)}`;
                 messageBox.classList.remove('hidden');
                 setTimeout(() => { messageBox.classList.add('hidden'); }, 3000);
                 return;
            }
            
            // –ù–∞—á–∏—Å–ª—è–µ–º –∑–∞—Ä–ø–ª–∞—Ç—É –∏ XP
            balance += job.salary;
            if (level < MAX_LEVEL) { // XP —Ç–æ–ª—å–∫–æ –¥–æ MAX_LEVEL
                xp += job.xpReward; 
            }
            checkLevelUp();
            
            jobCooldowns[levelId] = now; // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–æ–≤—ã–π –∫—É–ª–¥–æ—É–Ω

            saveState(); 

            messageBox.textContent = `–†–∞–±–æ—Ç–∞ "${job.name}" –≤—ã–ø–æ–ª–Ω–µ–Ω–∞! –ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ ${formatCurrency(job.salary)}. –ü–æ–ª—É—á–µ–Ω–æ ${job.xpReward} XP.`;
            messageBox.classList.remove('hidden');
            
            setTimeout(() => {
                messageBox.classList.add('hidden');
            }, 3000);
        };
        
        /** –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–æ–∫—É–ø–∫–∏ –ø–∞—Å—Å–∏–≤–Ω–æ–≥–æ —Ä–∞–±–æ—Ç–Ω–∏–∫–∞ */
        const handleWorkerPurchase = (event) => {
            const workerId = event.target.dataset.id;
            const worker = PASSIVE_WORKERS.find(w => w.id === workerId);
            
            if (!worker) return;

            if (passiveWorkersData[workerId]?.owned) return;
            
            if (balance < worker.price) {
                messageBox.textContent = `–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –¥–ª—è –ø–æ–∫—É–ø–∫–∏ ${worker.name}. –ù—É–∂–Ω–æ ${formatCurrency(worker.price)}.`;
                messageBox.classList.remove('hidden');
                setTimeout(() => { messageBox.classList.add('hidden'); }, 3000);
                return;
            }

            // –í—ã—á–∏—Ç–∞–µ–º —Ü–µ–Ω—É
            balance -= worker.price;
            
            passiveWorkersData[workerId] = {
                owned: true,
                lastIncomeTime: Date.now() 
            };
            
            saveState();

            messageBox.textContent = `üéâ –í—ã –∫—É–ø–∏–ª–∏ "${worker.name}"! –û–Ω –Ω–∞—á–∏–Ω–∞–µ—Ç –ø—Ä–∏–Ω–æ—Å–∏—Ç—å ${worker.incomePerSecond} ‚ÇΩ/—Å–µ–∫.`;
            messageBox.classList.remove('hidden');
            
            setTimeout(() => {
                messageBox.classList.add('hidden');
            }, 3000);
        };
        
        // --- Quest Logic ---

        /** –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–∞–≥—Ä–∞–¥—ã –∑–∞ –∫–≤–µ—Å—Ç */
        const handleQuestClaim = (event) => {
            const questId = parseInt(event.target.dataset.id);
            const quest = QUESTS.find(q => q.id === questId);

            if (!quest) return;
            
            const isCompleted = questProgress.completed[questId];
            let isReadyToClaim = false;
            let reqText;

            if (quest.type === 'level') {
                isReadyToClaim = level >= quest.requirement && !isCompleted;
                reqText = `–£—Ä. ${level}/${quest.requirement}`;
            } else { // 'wins'
                isReadyToClaim = questProgress.wins >= quest.requirement && !isCompleted;
                reqText = `${questProgress.wins}/${quest.requirement} –ø–æ–±–µ–¥`;
            }


            if (!isReadyToClaim) {
                messageBox.textContent = `–ö–≤–µ—Å—Ç –µ—â–µ –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω. –¢–µ–∫—É—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å: ${reqText}.`;
                messageBox.classList.remove('hidden');
                setTimeout(() => { messageBox.classList.add('hidden'); }, 3000);
                return;
            }
            
            // –ù–∞—á–∏—Å–ª—è–µ–º –Ω–∞–≥—Ä–∞–¥—É
            balance += quest.reward;
            
            // –ù–∞—á–∏—Å–ª—è–µ–º XP, –µ—Å–ª–∏ –µ—Å—Ç—å –Ω–∞–≥—Ä–∞–¥–∞ XP –∏ –º—ã –Ω–µ –Ω–∞ MAX_LEVEL
            if (quest.xpReward > 0 && level < MAX_LEVEL) {
                xp += quest.xpReward;
                checkLevelUp(); // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ª–∏ XP –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è —É—Ä–æ–≤–Ω—è
            }
            
            questProgress.completed[questId] = true;
            
            saveState();

            const rewardMessage = `${formatCurrency(quest.reward)}${quest.xpReward > 0 ? ` –∏ ${quest.xpReward} XP` : ''}`;

            messageBox.textContent = `üéÅ –ö–≤–µ—Å—Ç "${quest.name}" –≤—ã–ø–æ–ª–Ω–µ–Ω! –í—ã –ø–æ–ª—É—á–∏–ª–∏ ${rewardMessage}!`;
            messageBox.classList.remove('hidden');
            
            setTimeout(() => {
                messageBox.classList.add('hidden');
            }, 3000);
        };


        // --- Event Handlers ---

        /** –ì–ª–∞–≤–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–ò–ì–†–ê–¢–¨/–°–¢–û–ü" */
        const handlePlayStopClick = () => {
            if (gameState === 'RUNNING') {
                cashOut();
            } else if (gameState === 'IDLE' || gameState === 'CASHED_OUT' || gameState === 'CRASHED') {
                startGame();
            }
        };
        
        /** –ó–∞–ø—É—Å–∫–∞–µ—Ç —Ç–∞–π–º–µ—Ä –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫—É–ª–¥–æ—É–Ω–æ–≤ –≤ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–∏ "–†–∞–±–æ—Ç–∞" */
        const startWorkViewTimer = () => {
             // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
             setInterval(() => {
                 if (currentView === 'WORK') {
                     renderWorkView();
                 }
             }, 1000);
        };

        // --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞ ---
        document.addEventListener('DOMContentLoaded', () => {
            // –ü—Ä–∏—Å–≤–∞–∏–≤–∞–µ–º UI —ç–ª–µ–º–µ–Ω—Ç—ã
            balanceElement = document.getElementById('balance-display');
            levelElement = document.getElementById('level-display');
            xpElement = document.getElementById('xp-display');

            multiplierElement = document.getElementById('multiplier-display');
            betInputElement = document.getElementById('bet-input');
            playButton = document.getElementById('play-button');
            statusText = document.getElementById('status-text');
            messageBox = document.getElementById('message-box');
            rocketIcon = document.getElementById('rocket-icon-wrapper'); 
            
            gameTabButton = document.getElementById('game-tab');
            workTabButton = document.getElementById('work-tab');
            workListElement = document.getElementById('work-list');

            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏ –∑–∞–ø—É—Å–∫–∞–µ–º —Ü–∏–∫–ª—ã
            loadState();
            startPassiveIncomeLoop();
            startWorkViewTimer(); 

            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Event Listeners
            playButton.addEventListener('click', handlePlayStopClick);
            gameTabButton.addEventListener('click', () => setView('GAME'));
            workTabButton.addEventListener('click', () => setView('WORK'));
            
            betInputElement.addEventListener('input', (e) => {
                let value = parseFloat(e.target.value);
                if (isNaN(value) || value < 1) {
                    value = 1;
                }
                value = Math.min(value, balance);
                e.target.value = Math.floor(value); 
                betAmount = Math.floor(value);
                updateUI();
            });
            
            // –ù–∞—á–∞–ª—å–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ UI
            betInputElement.value = betAmount;
            setView('GAME'); 
            updateUI(); // –ü–µ—Ä–≤–∏—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
        });
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0d0e12; 
        }
        .text-shadow-custom {
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.8), 0 0 20px rgba(0, 255, 255, 0.5);
        }
        .multiplier-font {
            font-size: 5rem;
            line-height: 1;
            font-weight: 800;
        }
        @media (max-width: 640px) {
            .multiplier-font {
                font-size: 3.5rem;
            }
        }
        
        /* Keyframes for the explosion effect */
        @keyframes explode {
            0% { transform: scale(1) rotate(0deg); opacity: 1; }
            50% { transform: scale(2.5) rotate(10deg); opacity: 0.5; filter: drop-shadow(0 0 10px red); }
            100% { transform: scale(3) rotate(-10deg); opacity: 0; filter: drop-shadow(0 0 20px yellow); }
        }

        /* Explosion class applied to the rocket wrapper */
        .rocket-exploding {
            animation: explode 0.5s ease-out forwards;
        }

        /* General transition for smooth movement (used for translateY in JS) */
        #rocket-icon-wrapper {
            transition: transform 0.1s linear, opacity 0.5s;
            will-change: transform; 
        }

    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <!-- Main Game Container -->
    <div id="game-container" class="w-full max-w-md bg-gray-800 shadow-2xl rounded-xl p-6 border border-gray-700">
        
        <!-- Header: Balance, Level & Title -->
        <header class="mb-6 pb-3 border-b border-gray-700">
            <h1 class="text-2xl font-extrabold text-white mb-2">
                üöÄ <span class="text-indigo-400">CRASH</span> –ö–∞–∑–∏–Ω–æ
            </h1>
            <div class="flex justify-between items-end">
                <!-- Balance -->
                <div class="text-left">
                    <p class="text-sm text-gray-400">–ë–∞–ª–∞–Ω—Å</p>
                    <p id="balance-display" class="text-xl font-bold text-yellow-400">... ‚ÇΩ</p>
                </div>

                <!-- Level & XP -->
                <div class="text-right">
                    <p class="text-sm font-bold text-green-400">–£—Ä–æ–≤–µ–Ω—å <span id="level-display">1</span></p>
                    <p id="xp-display" class="text-xs text-gray-400">0 / 20 XP</p>
                    <!-- XP Bar -->
                    <div class="w-24 h-1 bg-gray-600 rounded-full mt-1 overflow-hidden">
                        <div id="xp-progress-bar" class="h-full bg-green-500 transition-all duration-300" style="width: 0%;"></div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Tab Navigation -->
        <div class="flex border-b border-gray-700 mb-6">
            <button id="game-tab" class="flex-1 py-3 text-sm font-medium border-b-2 transition duration-150 border-indigo-500 text-white">
                –ò–≥—Ä–∞ (Crash)
            </button>
            <button id="work-tab" class="flex-1 py-3 text-sm font-medium border-b-2 transition duration-150 border-transparent text-gray-400 hover:text-white">
                –†–∞–±–æ—Ç–∞ / –ö–≤–µ—Å—Ç—ã
            </button>
        </div>

        <!-- Alert/Message Box -->
        <div id="message-box" class="hidden bg-yellow-900 text-yellow-300 p-3 rounded-lg mb-4 text-center font-semibold transition-all duration-300">
            <!-- Messages appear here -->
        </div>

        <!-- Main Content Area -->
        <div>
            
            <!-- GAME VIEW -->
            <div id="game-content">
                <!-- Game Area: Multiplier Display -->
                <div id="game-area" class="bg-gray-900 rounded-xl p-6 text-center shadow-inner mb-6 relative overflow-hidden h-64 flex flex-col justify-center items-center">
                    
                    <!-- Rocket/Multiplier Icon Wrapper (for animation) -->
                    <div id="rocket-icon-wrapper" class="absolute inset-0 flex flex-col justify-center items-center h-full w-full">
                        <div class="text-6xl transition-all duration-500 text-indigo-400">
                            <!-- Inline SVG for a Rocket -->
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-16 h-16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M4.5 16.5l-3 3h3l1.5-1.5zM21 7l-2-2m-1-1l-2 2m-1 1l2 2m-1-1l-2-2m-1-1l2 2m-1-1l-2-2M2 2l10 10m10-10l-2 2m-1-1l-2-2m-1 1l2 2m-1-1l-2-2m-1 1l2 2m-1-1l-2-2M7.5 19.5l-3-3h3l1.5 1.5zM12 2v10m6-6l-4 4-2-2-4 4"/>
                                <path d="M12 2v20M2 12h20M15 9l-3 3-3-3M9 15l3-3 3 3"/>
                            </svg>
                        </div>
                    </div>
                    
                    <!-- Multiplier Value (always stays centered) -->
                    <div id="multiplier-display" class="multiplier-font text-white transition-all duration-300 text-shadow-custom relative z-10">
                        1.00x
                    </div>
                    
                    <!-- Status Text -->
                    <p id="status-text" class="text-sm text-gray-500 mt-2 relative z-10">–û–∂–∏–¥–∞–Ω–∏–µ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ä–∞—É–Ω–¥–∞...</p>
                </div>

                <!-- Bet Controls -->
                <div class="space-y-4">
                    
                    <!-- Bet Input -->
                    <div>
                        <label for="bet-input" class="block text-sm font-medium text-gray-400 mb-1">
                            –°—É–º–º–∞ —Å—Ç–∞–≤–∫–∏ (‚ÇΩ)
                        </label>
                        <input type="number" id="bet-input" value="10" min="1" max="100000"
                            class="w-full p-3 rounded-lg bg-gray-700 text-white border border-gray-600 focus:ring-indigo-500 focus:border-indigo-500 transition duration-150"
                            inputmode="numeric" />
                    </div>

                    <!-- Play/Stop Button -->
                    <button id="play-button" 
                            class="w-full p-4 rounded-xl text-white font-bold text-xl uppercase shadow-lg transition duration-200 
                                bg-green-600 hover:bg-green-700 active:bg-green-800 disabled:bg-gray-600 disabled:shadow-none"
                            disabled>
                        –ò–ì–†–ê–¢–¨
                    </button>
                </div>
            </div>
            
            <!-- WORK VIEW (Jobs and Quests) -->
            <div id="work-content" class="hidden">
                 <p class="text-sm text-gray-400 mb-4">
                     –í—ã–ø–æ–ª–Ω—è–π—Ç–µ —Ä–∞–±–æ—Ç—É –∏ –∑–∞–¥–∞–Ω–∏—è, —á—Ç–æ–±—ã –ø–æ–ø–æ–ª–Ω–∏—Ç—å —Å–≤–æ–π –±–∞–ª–∞–Ω—Å –∏ –±—ã—Å—Ç—Ä–µ–µ –ø–æ–≤—ã—Å–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å.
                 </p>
                 <div id="work-list" class="space-y-3">
                     <!-- Job and Quest cards will be rendered here -->
                     <div class="text-center text-gray-500 p-4">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</div>
                 </div>
            </div>
            
        </div>
    </div>
</body>
</html>

