<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crush –†–∞–∫–µ—Ç–∞ –ö–∞–∑–∏–Ω–æ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="text/javascript">
        // --- Game State Variables ---
        let balance = 1000; // –ò–∑–º–µ–Ω–µ–Ω–æ: –ù–∞—á–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å (‚ÇΩ)
        let level = 1;
        let xp = 0;
        let workerInventory = []; // [{ id: string, name: string, rarity: string, income: number, isActive: boolean, lastIncomeTime: number, lore: string }]
        let jobCooldowns = {}; // { level: timestamp }
        let questProgress = {
            wins: 0, 
            completed: {} 
        };
        let usedPromoCodes = []; // –î–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤

        const XP_PER_GAME = 1; // 1 XP –∑–∞ –∏–≥—Ä—É
        const STORAGE_KEY = 'crushGameDataV2'; // –ù–æ–≤—ã–π –∫–ª—é—á –¥–ª—è localStorage
        const MAX_LEVEL = 50; 
        const MAX_ACTIVE_WORKERS = 2; // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤
        const WORKER_SELL_MULTIPLIER = 20; // 20x –¥–æ—Ö–æ–¥–∞/—Å–µ–∫ –¥–ª—è –ø—Ä–æ–¥–∞–∂–∏ (—ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç 20% –æ—Ç 100—Ö –±–∞–∑–æ–≤–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏)
        
        let betAmount = 10;
        let currentMultiplier = 1.00;
        let crashPoint = 0;
        let gameState = 'IDLE'; // IDLE, RUNNING, CASHED_OUT, CRASHED
        let animationFrameId = null;
        let gameStartTime = 0;
        let isGameStarting = false;
        
        let currentView = 'GAME'; // 'GAME' or 'WORK'
        let isCaseOpening = false;
        let lastWorkerId = 0; // –î–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö ID —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤
        
        // --- Configuration ---

        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ü—Ä–æ–º–æ–∫–æ–¥–æ–≤
        const PROMO_CODES = {
            'MERRYCRISTMAS': { // –ö–æ–¥—ã —Ç–µ–ø–µ—Ä—å –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –≤ –≤–µ—Ä—Ö–Ω–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–µ
                reward: 'CASE_JOBERS',
                description_ru: '–ü–æ–¥–∞—Ä–æ–∫: 1 –ö–µ–π—Å "Jobers"',
            }
        };

        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ö–µ–π—Å–æ–≤ –∏ –†–∞–±–æ—Ç
        const CASE_PRICE = 10000; // –¶–µ–Ω–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –∫–µ–π—Å–∞
        const WORKER_TIERS = [
            // –®–∞–Ω—Å—ã –Ω–æ—Ä–º–∏—Ä–æ–≤–∞–Ω—ã, —á—Ç–æ–±—ã –≤ —Å—É–º–º–µ –±—ã–ª–æ 100%
            { rarity: 'Super Refrage', color: 'text-fuchsia-400', range: [5000, 20000], chance: 0.1, lore: '–§–∞–Ω—Ç–∞—Å—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–¥–∫–æ—Å—Ç—å. –≠—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–Ω–∏–∫, —ç—Ç–æ –∫–æ—Ä–ø–æ—Ä–∞—Ü–∏—è.' },
            { rarity: 'Legendary', color: 'text-orange-400', range: [120, 220], chance: 4.9, lore: '–°–≤–µ—Ä—Ö—ä–µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —Ç–∞–ª–∞–Ω—Ç, –ø—Ä–∏–Ω–æ—Å–∏—Ç –æ–≥—Ä–æ–º–Ω—É—é –ø—Ä–∏–±—ã–ª—å.' },
            { rarity: 'Mythical', color: 'text-purple-400', range: [80, 120], chance: 16.0, lore: '–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –Ω–µ –≤—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è, –Ω–æ –µ–≥–æ –Ω–∞–≤—ã–∫–∏ –±–µ—Å—Ü–µ–Ω–Ω—ã.' },
            { rarity: 'Epic', color: 'text-red-400', range: [50, 80], chance: 29.0, lore: '–í—ã—Å–æ–∫–æ–∫–ª–∞—Å—Å–Ω—ã–π —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç, –±—ã—Å—Ç—Ä–æ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç –¥–æ—Ö–æ–¥.' },
            { rarity: 'Rare', color: 'text-blue-400', range: [20, 50], chance: 25.0, lore: '–û–ø—ã—Ç–Ω—ã–π —Ä–∞–±–æ—Ç–Ω–∏–∫ —Å —Å–∏–ª—å–Ω—ã–º —Å—Ç—Ä–µ–º–ª–µ–Ω–∏–µ–º –∫ —É—Å–ø–µ—Ö—É.' },
            { rarity: 'Uncommon', color: 'text-green-400', range: [10, 20], chance: 15.0, lore: '–ù–∞–¥—ë–∂–Ω—ã–π, —Ç—Ä—É–¥–æ–ª—é–±–∏–≤—ã–π, –ø—Ä–∏–Ω–æ—Å–∏—Ç —Å—Ç–∞–±–∏–ª—å–Ω—ã–π –¥–æ—Ö–æ–¥.' },
            { rarity: 'Common', color: 'text-gray-400', range: [5, 10], chance: 10.0, lore: '–ë–∞–∑–æ–≤—ã–π —Ä–∞–±–æ—Ç–Ω–∏–∫, —Å –Ω–µ–≥–æ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –ª—é–±–∞—è –∏–º–ø–µ—Ä–∏—è.' }
        ].sort((a, b) => b.chance - a.chance); // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ —Ä–µ–¥–∫–æ—Å—Ç–∏ (–æ—Ç –Ω–∞–∏–º–µ–Ω—å—à–µ–≥–æ —à–∞–Ω—Å–∞)


        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ä—É—á–Ω—ã—Ö —Ä–∞–±–æ—Ç (–û—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
        const MANUAL_JOBS = [
            { level: 1, name: '–®—É–ª–ª–µ—Ä', salary: 120, xpReward: 2, cooldown: 59000, description: '–ë—ã—Å—Ç—Ä—ã–π, –Ω–æ –º–∞–ª–µ–Ω—å–∫–∏–π –¥–æ—Ö–æ–¥. –£—Ä. 1+' }, 
            { level: 5, name: '–®–∞—Ö—Ç—ë—Ä', salary: 400, xpReward: 4, cooldown: 120000, description: '–¢—è–∂–µ–ª—ã–π —Ç—Ä—É–¥, —Ö–æ—Ä–æ—à–∞—è –∑–∞—Ä–ø–ª–∞—Ç–∞. –£—Ä. 5+' }, 
            { level: 10, name: '–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç', salary: 5000, xpReward: 8, cooldown: 180000, description: '–û—Å–≤–æ–µ–Ω–Ω—ã–µ –Ω–∞–≤—ã–∫–∏, –ø—Ä–∏–Ω–æ—Å—è—â–∏–µ –±–æ–ª—å—à–æ–π –¥–æ—Ö–æ–¥. –£—Ä. 10+' }, 
            { level: 15, name: '–ò–Ω–∂–µ–Ω–µ—Ä', salary: 6800, xpReward: 12, cooldown: 300000, description: '–í—ã—Å–æ–∫–æ–∫–≤–∞–ª–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞. –£—Ä. 15+' } 
        ];
        
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–≤–µ—Å—Ç–æ–≤ 
        const QUESTS = [
            { id: 1, name: '–ù–æ–≤–∏—á–æ–∫', type: 'level', requirement: 2, reward: 500, xpReward: 12, unlockLevel: 1, description: '–î–æ—Å—Ç–∏–≥–Ω–∏—Ç–µ –£—Ä–æ–≤–Ω—è 2.' },
            { id: 2, name: '–ü–µ—Ä–≤—ã–π –†—ã–≤–æ–∫', type: 'level', requirement: 4, reward: 1500, xpReward: 12, unlockLevel: 2, description: '–î–æ—Å—Ç–∏–≥–Ω–∏—Ç–µ –£—Ä–æ–≤–Ω—è 4.' },
            { id: 3, name: '–í –°–µ—Ä–µ–¥–∏–Ω—É', type: 'level', requirement: 7, reward: 4500, xpReward: 12, unlockLevel: 5, description: '–î–æ—Å—Ç–∏–≥–Ω–∏—Ç–µ –£—Ä–æ–≤–Ω—è 7.' },
            { id: 4, name: '–ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π', type: 'level', requirement: 12, reward: 3500, xpReward: 12, unlockLevel: 9, description: '–î–æ—Å—Ç–∏–≥–Ω–∏—Ç–µ –£—Ä–æ–≤–Ω—è 12.' },
            { id: 5, name: '–ù–∞ –ü–æ–¥—Ö–æ–¥–µ', type: 'level', requirement: 16, reward: 5700, xpReward: 12, unlockLevel: 13, description: '–î–æ—Å—Ç–∏–≥–Ω–∏—Ç–µ –£—Ä–æ–≤–Ω—è 16.' },
            { id: 6, name: '–§–∏–Ω–∏—à–Ω–∞—è –ü—Ä—è–º–∞—è', type: 'level', requirement: 20, reward: 6600, xpReward: 24, unlockLevel: 15, description: '–î–æ—Å—Ç–∏–≥–Ω–∏—Ç–µ –£—Ä–æ–≤–Ω—è 20.' },
            { id: 101, name: '–ü–µ—Ä–≤–∞—è –°—Ç—É–ø–µ–Ω—å', type: 'wins', requirement: 20, reward: 13800, xpReward: 0, unlockLevel: 20, description: '–í—ã–∏–≥—Ä–∞—Ç—å –≤ –∫—Ä–∞—à-–∏–≥—Ä–µ 20 —Ä–∞–∑.' },
            { id: 102, name: '–û–ø—ã—Ç–Ω—ã–π –ò–≥—Ä–æ–∫', type: 'wins', requirement: 45, reward: 49000, xpReward: 0, unlockLevel: 20, description: '–í—ã–∏–≥—Ä–∞—Ç—å –≤ –∫—Ä–∞—à-–∏–≥—Ä–µ 45 —Ä–∞–∑.' }
        ];


        // UI Elements
        let balanceElement, levelElement, xpElement, multiplierElement, betInputElement, playButton, gameArea, messageBox, rocketIcon, statusText;
        let gameTabButton, workTabButton, workListElement, caseOpeningModal;
        
        // –ù–û–í–´–ï UI —ç–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è –ü—Ä–æ–º–æ–∫–æ–¥–æ–≤/–†–∞–±–æ—Ç—ã
        let promoCodeInputElement;
        let promoCodeMessageElement;

        // –ù–û–í–´–ï UI —ç–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è –ü—Ä–æ–¥–∞–∂–∏ –†–∞–±–æ—Ç–Ω–∏–∫–∞
        let workerActionModal, workerActionTitle, workerActionMessage, workerActionButton;
        let currentWorkerActionId = null; // ID —Ä–∞–±–æ—Ç–Ω–∏–∫–∞, –∫–æ—Ç–æ—Ä—ã–π —Å–µ–π—á–∞—Å –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ
        
        // –ù–û–í–´–ô UI —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –®–∞–Ω—Å–æ–≤ –ö–µ–π—Å–∞
        let rarityModal; 
        
        // --- Utility Functions ---

        /** –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤–µ—Å—å –∏–≥—Ä–æ–≤–æ–π —Å—Ç–µ–π—Ç –≤ localStorage */
        const saveState = () => {
            try {
                const dataToStore = {
                    balance: balance,
                    level: level,
                    xp: xp,
                    workerInventory: workerInventory, 
                    jobCooldowns: jobCooldowns,
                    questProgress: questProgress,
                    lastWorkerId: lastWorkerId,
                    usedPromoCodes: usedPromoCodes 
                };
                localStorage.setItem(STORAGE_KEY, JSON.stringify(dataToStore));
            } catch (e) {
                console.error("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ localStorage:", e);
            }
            updateUI();
        };

        /** –ó–∞–≥—Ä—É–∂–∞–µ—Ç –≤–µ—Å—å –∏–≥—Ä–æ–≤–æ–π —Å—Ç–µ–π—Ç –∏–∑ localStorage */
        const loadState = () => {
            try {
                const storedData = localStorage.getItem(STORAGE_KEY);
                if (storedData) {
                    const data = JSON.parse(storedData);
                    balance = data.balance || 1000;
                    level = data.level || 1;
                    xp = data.xp || 0;
                    jobCooldowns = data.jobCooldowns || {}; 
                    questProgress = data.questProgress || { wins: 0, completed: {} };
                    usedPromoCodes = data.usedPromoCodes || []; 
                    if (!questProgress.completed) questProgress.completed = {};

                    // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
                    workerInventory = data.workerInventory || [];
                    lastWorkerId = data.lastWorkerId || 0;
                    
                    // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –≤—Å–µ —Ä–∞–±–æ—Ç–Ω–∏–∫–∏ –∏–º–µ—é—Ç lastIncomeTime
                    workerInventory.forEach(w => {
                        if (w.isActive && w.lastIncomeTime === undefined) {
                            w.lastIncomeTime = Date.now();
                        }
                    });

                    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                    if (balance < 10) { 
                        balance = 1000; 
                        messageBox.textContent = "–ë–∞–ª–∞–Ω—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –¥–æ 1000 ‚ÇΩ.";
                        messageBox.classList.remove('hidden');
                        setTimeout(() => { messageBox.classList.add('hidden'); }, 3000);
                        saveState(); 
                    }
                    
                    processOfflineIncome();
                    
                    return true; 
                }
            } catch (e) {
                console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–∑ localStorage:", e);
            }
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è, –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç
            balance = 1000; 
            level = 1;
            xp = 0;
            jobCooldowns = {};
            questProgress = { wins: 0, completed: {} };
            workerInventory = [];
            lastWorkerId = 0;
            usedPromoCodes = []; 
            messageBox.textContent = "–ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å. –ù–∞—á–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å 1000 ‚ÇΩ, –£—Ä. 1.";
            messageBox.classList.remove('hidden');
            setTimeout(() => { messageBox.classList.add('hidden'); }, 3000);
            return false; 
        };

        /** –í—ã—á–∏—Å–ª—è–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–π XP –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —É—Ä–æ–≤–Ω—è. */
        const getRequiredXP = (currentLevel) => {
            if (currentLevel >= MAX_LEVEL) {
                return Infinity; 
            }
            return 20 + (currentLevel - 1) * 5; 
        };

        /** –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —á–∏—Å–ª–æ –≤ –≤–∞–ª—é—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Å —Å–∏–º–≤–æ–ª–æ–º ‚ÇΩ */
        const formatCurrency = (amount) => {
            return `${Math.floor(amount).toLocaleString('ru-RU')} ‚ÇΩ`;
        };
        
        /** –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –º–Ω–æ–∂–∏—Ç–µ–ª—å */
        const formatMultiplier = (multiplier) => {
            return multiplier.toFixed(2) + 'x';
        };
        
        /** –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —Ä–∞–∑–Ω–∏—Ü—É –≤–æ –≤—Ä–µ–º–µ–Ω–∏ (–¥–ª—è –∫—É–ª–¥–æ—É–Ω–æ–≤) */
        const formatTimeDifference = (ms) => {
            if (ms <= 0) return '–ì–æ—Ç–æ–≤';
            const totalSeconds = Math.ceil(ms / 1000);
            const minutes = Math.floor(totalSeconds / 60);
            const seconds = totalSeconds % 60;
            return `${minutes}:${seconds.toString().padStart(2, '0')}`;
        };

        /** –ù–∞—Ö–æ–¥–∏—Ç –∫–ª–∞—Å—Å —Ü–≤–µ—Ç–∞ Tailwind –¥–ª—è —Ä–µ–¥–∫–æ—Å—Ç–∏ */
        const getRarityColorClass = (rarity) => {
            const tier = WORKER_TIERS.find(t => t.rarity === rarity);
            return tier ? tier.color : 'text-gray-400';
        };
        
        /** –ü—Ä–æ–≤–µ—Ä—è–µ—Ç XP –∏ –ø–æ–≤—ã—à–∞–µ—Ç —É—Ä–æ–≤–µ–Ω—å –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ */
        const checkLevelUp = () => {
            let changed = false;
            
            if (level >= MAX_LEVEL) {
                xp = 0; 
                return false;
            }

            const requiredXP = getRequiredXP(level);
            
            if (xp >= requiredXP) {
                level += 1;
                xp -= requiredXP;
                changed = true;
                
                if (level === MAX_LEVEL) {
                    messageBox.textContent = `‚≠ê –î–û–°–¢–ò–ì–ù–£–¢ –ú–ê–ö–°–ò–ú–ê–õ–¨–ù–´–ô –£–†–û–í–ï–ù–¨ (${MAX_LEVEL})! ‚≠ê`;
                    xp = 0; 
                } else {
                    messageBox.textContent = `üí• –ü–û–ó–î–†–ê–í–õ–Ø–ï–ú! –í—ã –¥–æ—Å—Ç–∏–≥–ª–∏ –£–†–û–í–ù–Ø ${level}!`;
                }
                
                messageBox.classList.remove('hidden');
                setTimeout(() => { messageBox.classList.add('hidden'); }, 3000);

                if (level < MAX_LEVEL && xp >= getRequiredXP(level)) {
                     return checkLevelUp(); 
                }
            }
            return changed;
        };


        /** –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥–æ—Ö–æ–¥, –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã–π –≤ –æ—Ñ–ª–∞–π–Ω–µ */
        const processOfflineIncome = () => {
            let totalIncome = 0;
            const now = Date.now();
            let shouldUpdate = false;
            
            workerInventory.forEach(worker => {
                if (worker.isActive && worker.lastIncomeTime) {
                    const timeElapsedMs = now - worker.lastIncomeTime;
                    
                    if (timeElapsedMs >= 1000) {
                        const timeElapsedSeconds = Math.floor(timeElapsedMs / 1000);
                        const earned = timeElapsedSeconds * worker.income;
                        
                        totalIncome += earned;
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –¥–æ—Ö–æ–¥–∞ —Ä–∞–±–æ—Ç–Ω–∏–∫–∞
                        worker.lastIncomeTime = worker.lastIncomeTime + (timeElapsedSeconds * 1000);
                        shouldUpdate = true;
                    }
                }
            });

            if (totalIncome > 0) {
                balance += totalIncome;
                saveState();
                
                messageBox.textContent = `üöÄ –ó–∞ –≤—Ä–µ–º—è –≤–∞—à–µ–≥–æ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –∞–∫—Ç–∏–≤–Ω—ã–µ —Ä–∞–±–æ—Ç–Ω–∏–∫–∏ –∑–∞—Ä–∞–±–æ—Ç–∞–ª–∏ ${formatCurrency(totalIncome)}!`;
                messageBox.classList.remove('hidden');
                setTimeout(() => { messageBox.classList.add('hidden'); }, 4000);
            } else if (shouldUpdate) {
                saveState();
            }
        };

        /** –ü—Ä–∏–º–µ–Ω—è–µ—Ç –ø–∞—Å—Å–∏–≤–Ω—ã–π –¥–æ—Ö–æ–¥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ */
        const applyLivePassiveIncome = () => {
             let totalIncome = 0;
             const now = Date.now();
             let shouldUpdate = false;

             workerInventory.forEach(worker => {
                 if (worker.isActive) {
                     // –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ lastIncomeTime —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
                     if (!worker.lastIncomeTime) {
                         worker.lastIncomeTime = now;
                         shouldUpdate = true;
                     } else {
                         const timeElapsedMs = now - worker.lastIncomeTime;
                         if (timeElapsedMs >= 1000) {
                            const timeElapsedSeconds = Math.floor(timeElapsedMs / 1000);
                            const earned = timeElapsedSeconds * worker.income;
                            
                            totalIncome += earned;

                            worker.lastIncomeTime = worker.lastIncomeTime + (timeElapsedSeconds * 1000);
                            shouldUpdate = true;
                         }
                     }
                 }
             });

             if (totalIncome > 0) {
                 balance += totalIncome;
                 saveState();
             } else if (shouldUpdate) {
                  saveState();
             }
        };

        /** –ó–∞–ø—É—Å–∫–∞–µ—Ç —Ü–∏–∫–ª –ø–∞—Å—Å–∏–≤–Ω–æ–≥–æ –¥–æ—Ö–æ–¥–∞ */
        const startPassiveIncomeLoop = () => {
             setInterval(applyLivePassiveIncome, 1000);
        };
        
        // --- Promo Code Logic ---
        
        /** –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ, —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ–µ –¥–ª—è –ü—Ä–æ–º–æ–∫–æ–¥–æ–≤/–†–∞–±–æ—Ç */
        const setWorkMessage = (message, colorClass) => {
            if (!promoCodeMessageElement) return;

            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–ª–∞—Å—Å—ã
            promoCodeMessageElement.className = `p-2 rounded-lg text-sm text-center font-semibold mt-2 ${colorClass} bg-opacity-20`;
            promoCodeMessageElement.classList.add(colorClass.replace('text-', 'bg-') + '-900', 'bg-opacity-20');
            promoCodeMessageElement.textContent = message;
            promoCodeMessageElement.classList.remove('hidden');
            
            // –£–¥–∞–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
            setTimeout(() => {
                 if (promoCodeMessageElement) {
                     promoCodeMessageElement.classList.add('hidden');
                     promoCodeMessageElement.textContent = '';
                 }
            }, 5000);
        };
        
        /** –î–æ–±–∞–≤–ª—è–µ—Ç –∞–Ω–∏–º–∞—Ü–∏—é —Ç—Ä—è—Å–∫–∏ –∫ –ø–æ–ª—é –≤–≤–æ–¥–∞ –ø—Ä–æ–º–æ–∫–æ–¥–∞ */
        const shakeInput = () => {
            if (promoCodeInputElement) {
                promoCodeInputElement.classList.add('animate-shake');
                setTimeout(() => {
                    promoCodeInputElement.classList.remove('animate-shake');
                }, 500);
            }
        };

        /** –ê–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –ø—Ä–æ–º–æ–∫–æ–¥ */
        const redeemPromoCode = (code) => {
            code = code.trim();
            const upperCaseCode = code.toUpperCase(); // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–µ—Ä—Ö–Ω–∏–π —Ä–µ–≥–∏—Å—Ç—Ä
            const codeData = PROMO_CODES[upperCaseCode]; // –ò—â–µ–º –ø–æ –≤–µ—Ä—Ö–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É
            
            if (!code) {
                setWorkMessage('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥.', 'text-red-400');
                shakeInput();
                return;
            }

            if (!codeData) {
                setWorkMessage('–ù–µ–≤–µ—Ä–Ω—ã–π –ø—Ä–æ–º–æ–∫–æ–¥.', 'text-red-400');
                shakeInput();
                return;
            }
            
            if (usedPromoCodes.includes(upperCaseCode)) {
                setWorkMessage(`–ü—Ä–æ–º–æ–∫–æ–¥ "${code}" —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω.`, 'text-red-400');
                shakeInput();
                return;
            }

            // --- –ü—Ä–∏–º–µ–Ω—è–µ–º –Ω–∞–≥—Ä–∞–¥—É ---
            if (codeData.reward === 'CASE_JOBERS') {
                
                // 1. –†–æ–ª–ª —Ä–µ–¥–∫–æ—Å—Ç–∏
                const rolledTier = rollRarity();
                
                // 2. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–æ—Ö–æ–¥–∞
                const minIncome = rolledTier.range[0];
                const maxIncome = rolledTier.range[1];
                const generatedIncome = Math.floor(Math.random() * (maxIncome - minIncome + 1)) + minIncome;

                // 3. –°–æ–∑–¥–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–Ω–∏–∫–∞
                lastWorkerId++;
                const newWorker = {
                    id: `worker-${lastWorkerId}`,
                    name: `(–ü—Ä–æ–º–æ) ${rolledTier.rarity} –†–∞–±–æ—Ç–Ω–∏–∫ #${lastWorkerId}`,
                    rarity: rolledTier.rarity,
                    income: generatedIncome,
                    isActive: false, 
                    lastIncomeTime: 0,
                    lore: rolledTier.lore
                };
                
                // 4. –ó–∞–ø—É—Å–∫ –∞–Ω–∏–º–∞—Ü–∏–∏ –æ—Ç–∫—Ä—ã—Ç–∏—è –∫–µ–π—Å–∞ (–∏–º–∏—Ç–∞—Ü–∏—è)
                usedPromoCodes.push(upperCaseCode); // –û—Ç–º–µ—á–∞–µ–º –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–π –¥–æ –∞–Ω–∏–º–∞—Ü–∏–∏
                animateCaseOpening(newWorker); // –ê–Ω–∏–º–∞—Ü–∏—è —Å–∞–º–∞ –¥–æ–±–∞–≤–∏—Ç –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç
                
                setWorkMessage(`‚úÖ –ü—Ä–æ–º–æ–∫–æ–¥ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω! –°–º–æ—Ç—Ä–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –æ–∫–Ω–µ!`, 'text-green-400');

                // –û—á–∏—Å—Ç–∫–∞ –≤–≤–æ–¥–∞
                if (promoCodeInputElement) {
                    promoCodeInputElement.value = '';
                }

            } else {
                setWorkMessage('–û—à–∏–±–∫–∞: –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –Ω–∞–≥—Ä–∞–¥–∞ –ø—Ä–æ–º–æ–∫–æ–¥–∞.', 'text-red-400');
            }
        };


        // --- Case and Worker Logic ---
        
        /** –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å —à–∞–Ω—Å–∞–º–∏ —Ä–µ–¥–∫–æ—Å—Ç–∏ */
        const openRarityModal = () => {
            const content = document.getElementById('rarity-result-content');
            content.innerHTML = ''; // –û—á–∏—Å—Ç–∫–∞
            
            let htmlContent = `<p class="text-gray-400 mb-4 text-sm">–®–∞–Ω—Å –≤—ã–ø–∞–¥–µ–Ω–∏—è —Ä–∞–±–æ—Ç–Ω–∏–∫–∞ –∏–∑ –ö–µ–π—Å–∞ "Jobers":</p>`;
            
            htmlContent += WORKER_TIERS.map(tier => {
                const colorClass = getRarityColorClass(tier.rarity);
                // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∏–∞–ø–∞–∑–æ–Ω –¥–æ—Ö–æ–¥–∞
                const incomeRange = tier.range[0] === tier.range[1] 
                    ? formatCurrency(tier.range[0])
                    : `${formatCurrency(tier.range[0])} - ${formatCurrency(tier.range[1])}`;
                    
                return `
                    <div class="flex justify-between items-center py-2 border-b border-gray-700 last:border-b-0">
                        <p class="font-bold ${colorClass}">${tier.rarity}</p>
                        <div class="text-right">
                           <p class="text-lg font-extrabold ${colorClass}">${tier.chance}%</p>
                           <p class="text-xs text-gray-500">${incomeRange}/—Å–µ–∫</p>
                        </div>
                    </div>
                `;
            }).join('');
            
            content.innerHTML = htmlContent;
            rarityModal.classList.remove('hidden');
        };

        /** –†–∞—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Ü–µ–Ω—É –ø—Ä–æ–¥–∞–∂–∏ —Ä–∞–±–æ—Ç–Ω–∏–∫–∞ */
        const calculateSellPrice = (income) => {
            // –¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏ = –î–æ—Ö–æ–¥ –≤ —Å–µ–∫—É–Ω–¥—É * –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –ø—Ä–æ–¥–∞–∂–∏
            return Math.floor(income * WORKER_SELL_MULTIPLIER);
        };
        
        /** –í—ã–±–∏—Ä–∞–µ—Ç —Ä–µ–¥–∫–æ—Å—Ç—å –Ω–∞ –æ—Å–Ω–æ–≤–µ —à–∞–Ω—Å–æ–≤ */
        const rollRarity = () => {
            const roll = Math.random() * 100; // 0.00 to 99.99
            let cumulativeChance = 0;

            for (const tier of WORKER_TIERS) {
                cumulativeChance += tier.chance;
                if (roll < cumulativeChance) {
                    return tier;
                }
            }
            // Fallback (should not happen if chances total 100)
            return WORKER_TIERS[WORKER_TIERS.length - 1]; // Common
        };

        /** –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –∫–µ–π—Å "Jobers" */
        const openJobersCase = () => {
            if (isCaseOpening) return;
            
            if (balance < CASE_PRICE) {
                messageBox.textContent = `–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤. –î–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –∫–µ–π—Å–∞ –Ω—É–∂–Ω–æ ${formatCurrency(CASE_PRICE)}.`;
                messageBox.classList.remove('hidden');
                setTimeout(() => { messageBox.classList.add('hidden'); }, 3000);
                return;
            }
            
            // 1. –í—ã—á–∏—Ç–∞–µ–º —Ü–µ–Ω—É
            balance -= CASE_PRICE;
            isCaseOpening = true;
            updateUI(); // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å –∏ –±–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É

            // 2. –†–æ–ª–ª —Ä–µ–¥–∫–æ—Å—Ç–∏
            const rolledTier = rollRarity();
            
            // 3. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–æ—Ö–æ–¥–∞
            const minIncome = rolledTier.range[0];
            const maxIncome = rolledTier.range[1];
            const generatedIncome = Math.floor(Math.random() * (maxIncome - minIncome + 1)) + minIncome;

            // 4. –°–æ–∑–¥–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–Ω–∏–∫–∞
            lastWorkerId++;
            const newWorker = {
                id: `worker-${lastWorkerId}`,
                name: `${rolledTier.rarity} –†–∞–±–æ—Ç–Ω–∏–∫ #${lastWorkerId}`,
                rarity: rolledTier.rarity,
                income: generatedIncome,
                isActive: false, // –ò–∑–Ω–∞—á–∞–ª—å–Ω–æ –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω
                lastIncomeTime: 0,
                lore: rolledTier.lore
            };
            
            // 5. –ó–∞–ø—É—Å–∫ –∞–Ω–∏–º–∞—Ü–∏–∏
            animateCaseOpening(newWorker);
        };

        /** –ê–Ω–∏–º–∞—Ü–∏—è –æ—Ç–∫—Ä—ã—Ç–∏—è –∫–µ–π—Å–∞ */
        const animateCaseOpening = (newWorker) => {
            const modal = caseOpeningModal;
            const content = document.getElementById('case-result-content');
            
            // –°–±—Ä–æ—Å –∏ –ø–æ–∫–∞–∑ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
            content.innerHTML = `<p class="text-2xl text-white animate-pulse">*** –û—Ç–∫—Ä—ã—Ç–∏–µ –ö–µ–π—Å–∞ ***</p>`;
            modal.classList.remove('hidden');
            
            // –®–∞–≥ 1: –ó–∞–¥–µ—Ä–∂–∫–∞ (–≤—Ä–∞—â–µ–Ω–∏–µ)
            setTimeout(() => {
                content.innerHTML = `<p class="text-xl text-gray-400 mb-4">–†–æ–∑—ã–≥—Ä—ã—à —Ä–µ–¥–∫–æ—Å—Ç–∏...</p>`;
            }, 1000);

            // –®–∞–≥ 2: –í—ã–≤–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
            setTimeout(() => {
                const colorClass = getRarityColorClass(newWorker.rarity);
                
                content.innerHTML = `
                    <div class="animate-bounce-in p-6 rounded-lg shadow-2xl bg-gray-900 border-4 border-current ${colorClass.replace('text-', 'border-')}">
                        <p class="text-2xl font-extrabold ${colorClass}">
                            ${newWorker.rarity.toUpperCase()}!
                        </p>
                        <p class="text-xl text-white mt-2">${newWorker.name}</p>
                        <p class="text-4xl font-black ${colorClass} mt-4">${newWorker.income} ‚ÇΩ/—Å–µ–∫</p>
                        <p class="text-sm text-gray-400 mt-2">${newWorker.lore}</p>
                    </div>
                    <button id="close-case-btn" class="mt-6 px-6 py-3 bg-indigo-600 text-white font-bold rounded-lg hover:bg-indigo-700 transition">
                        –î–æ–±–∞–≤–∏—Ç—å –≤ –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å
                    </button>
                `;
                
                // –î–æ–±–∞–≤–ª—è–µ–º —Ä–∞–±–æ—Ç–Ω–∏–∫–∞ –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º
                workerInventory.push(newWorker);
                saveState();

                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
                document.getElementById('close-case-btn').addEventListener('click', () => {
                    modal.classList.add('hidden');
                    isCaseOpening = false;
                    setView('WORK'); // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å (–∑–∞–ø—É—Å—Ç–∏—Ç full render)
                });
                
            }, 2500); 
        };
        
        /** –ê–∫—Ç–∏–≤–∏—Ä—É–µ—Ç/–¥–µ–∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç–Ω–∏–∫–∞ */
        const toggleWorkerActive = (workerId) => {
            const worker = workerInventory.find(w => w.id === workerId);
            if (!worker) return;
            
            const currentlyActive = workerInventory.filter(w => w.isActive).length;

            if (worker.isActive) {
                // –î–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è
                worker.isActive = false;
                worker.lastIncomeTime = 0; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Ä–µ–º—è
            } else {
                // –ê–∫—Ç–∏–≤–∞—Ü–∏—è
                if (currentlyActive >= MAX_ACTIVE_WORKERS) {
                    messageBox.textContent = `‚ùå –î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤ (${MAX_ACTIVE_WORKERS}). –î–µ–∞–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –æ–¥–Ω–æ–≥–æ.`;
                    messageBox.classList.remove('hidden');
                    setTimeout(() => { messageBox.classList.add('hidden'); }, 3000);
                    return;
                }
                worker.isActive = true;
                worker.lastIncomeTime = Date.now();
            }

            saveState();
            _renderFullWorkView(); // –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
        };

        /** –ü—Ä–æ–¥–∞–µ—Ç —Ä–∞–±–æ—Ç–Ω–∏–∫–∞ –∏ –∑–∞—á–∏—Å–ª—è–µ—Ç —Å—Ä–µ–¥—Å—Ç–≤–∞ –Ω–∞ –±–∞–ª–∞–Ω—Å */
        const sellWorker = (workerId) => {
            const index = workerInventory.findIndex(w => w.id === workerId);
            if (index === -1) {
                 messageBox.textContent = '‚ùå –û—à–∏–±–∫–∞: –†–∞–±–æ—Ç–Ω–∏–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω.';
                 messageBox.classList.remove('hidden');
                 setTimeout(() => { messageBox.classList.add('hidden'); }, 3000);
                 return;
            }

            const worker = workerInventory[index];
            const sellPrice = calculateSellPrice(worker.income);

            if (worker.isActive) {
                worker.isActive = false; // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è –ø–µ—Ä–µ–¥ –ø—Ä–æ–¥–∞–∂–µ–π
            }

            // –£–¥–∞–ª—è–µ–º —Ä–∞–±–æ—Ç–Ω–∏–∫–∞
            workerInventory.splice(index, 1);
            
            // –ó–∞—á–∏—Å–ª—è–µ–º —Å—Ä–µ–¥—Å—Ç–≤–∞
            balance += sellPrice;
            saveState();

            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            workerActionModal.classList.add('hidden');
            currentWorkerActionId = null;

            messageBox.textContent = `‚úÖ –†–∞–±–æ—Ç–Ω–∏–∫ "${worker.name}" –ø—Ä–æ–¥–∞–Ω –∑–∞ ${formatCurrency(sellPrice)}.`;
            messageBox.classList.remove('hidden');
            setTimeout(() => { messageBox.classList.add('hidden'); }, 3000);
            
            _renderFullWorkView(); // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∞ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
        };

        
        /** –†–µ–Ω–¥–µ—Ä–∏—Ç —Å–ø–∏—Å–æ–∫ —Ä–∞–±–æ—Ç –∏ –∫–≤–µ—Å—Ç–æ–≤ (–ü–û–õ–ù–ê–Ø –ü–ï–†–ï–†–ò–°–û–í–ö–ê - –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ —Å–º–µ–Ω–µ –≤–∫–ª–∞–¥–∫–∏ –∏–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è) */
        const _renderFullWorkView = () => {
            if (!workListElement) return;

            workListElement.innerHTML = ''; // –û—á–∏—Å—Ç–∫–∞
            
            // --- 0. –ü—Ä–æ–º–æ–∫–æ–¥—ã (–ù–û–í–´–ô –†–ê–ó–î–ï–õ) ---
            const promoTitle = document.createElement('h3');
            promoTitle.className = 'text-lg font-bold text-pink-400 mb-3 mt-0 border-b border-gray-700 pb-1';
            promoTitle.textContent = '–ê–∫—Ç–∏–≤–∞—Ü–∏—è –ü—Ä–æ–º–æ–∫–æ–¥–∞';
            workListElement.appendChild(promoTitle);

            const promoCard = document.createElement('div');
            promoCard.className = 'bg-gray-700 p-4 rounded-lg shadow-md mb-3';
            promoCard.innerHTML = `
                <div class="flex flex-col space-y-2 sm:flex-row sm:space-y-0 sm:space-x-2">
                    <input type="text" id="promo-code-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥ (–Ω–∞–ø—Ä–∏–º–µ—Ä, MERRYCRISTMAS)"
                        class="flex-1 p-2 rounded-lg bg-gray-900 text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-pink-500 uppercase" />
                    <button id="redeem-promo-btn" 
                            class="px-4 py-2 text-sm rounded-lg font-semibold text-white transition bg-pink-600 hover:bg-pink-700 active:bg-pink-800">
                        –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å
                    </button>
                </div>
                <div id="promo-code-message" class="hidden"></div>
            `;
            workListElement.appendChild(promoCard);
            
            // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å—Å—ã–ª–æ–∫ –Ω–∞ UI —ç–ª–µ–º–µ–Ω—Ç—ã –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞
            promoCodeInputElement = document.getElementById('promo-code-input');
            promoCodeMessageElement = document.getElementById('promo-code-message');

            document.getElementById('redeem-promo-btn').addEventListener('click', () => {
                const code = promoCodeInputElement.value;
                redeemPromoCode(code);
            });


            // --- 1. –ö–µ–π—Å "Jobers" ---
            const caseHeader = document.createElement('div');
            caseHeader.className = 'flex items-center justify-between mb-3 mt-4 border-b border-gray-700 pb-1';
            caseHeader.innerHTML = `
                <h3 class="text-lg font-bold text-yellow-400">–ö–µ–π—Å "Jobers"</h3>
                <button id="rarity-info-btn" class="text-yellow-500 hover:text-yellow-400 transition ml-2 p-1 rounded-full bg-gray-700">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10"></circle><path d="M12 16v-4"></path><path d="M12 8h.01"></path>
                    </svg>
                </button>
            `;
            workListElement.appendChild(caseHeader);
            
            document.getElementById('rarity-info-btn').addEventListener('click', openRarityModal);

            const canAfford = balance >= CASE_PRICE;
            const buttonClass = canAfford 
                ? 'bg-yellow-600 hover:bg-yellow-700 active:bg-yellow-800'
                : 'bg-red-900 text-red-300 cursor-not-allowed';

            const caseCard = document.createElement('div');
            caseCard.className = 'flex items-center justify-between bg-gray-700 p-4 rounded-lg shadow-md mb-3';
            caseCard.innerHTML = `
                <div>
                    <p class="text-lg font-bold text-white">–û—Ç–∫—Ä—ã—Ç—å "Jobers"</p>
                    <p class="text-sm text-gray-400">–ü–æ–ª—É—á–∏—Ç–µ —Å–ª—É—á–∞–π–Ω–æ–≥–æ —Ä–∞–±–æ—Ç–Ω–∏–∫–∞.</p>
                </div>
                <div class="text-right">
                    <button id="case-btn" 
                            class="px-4 py-2 text-sm rounded-lg font-semibold text-white transition ${buttonClass}"
                            ${canAfford && !isCaseOpening ? '' : 'disabled'}>
                        –û—Ç–∫—Ä—ã—Ç—å (${formatCurrency(CASE_PRICE)})
                    </button>
                </div>
            `;
            workListElement.appendChild(caseCard);
            
            document.getElementById('case-btn').addEventListener('click', openJobersCase);

            // --- 2. –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –†–∞–±–æ—Ç–Ω–∏–∫–æ–≤ ---
            const activeWorkersCount = workerInventory.filter(w => w.isActive).length;
            const inventoryTitle = document.createElement('h3');
            inventoryTitle.className = 'text-lg font-bold text-indigo-400 mb-3 mt-6 border-b border-gray-700 pb-1';
            inventoryTitle.innerHTML = `–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –†–∞–±–æ—Ç–Ω–∏–∫–æ–≤ <span class="text-sm text-yellow-400">(${activeWorkersCount}/${MAX_ACTIVE_WORKERS} –∞–∫—Ç–∏–≤–Ω–æ)</span>`;
            workListElement.appendChild(inventoryTitle);
            
            if (workerInventory.length === 0) {
                 const emptyMessage = document.createElement('p');
                 emptyMessage.className = 'text-center text-gray-500 p-4 bg-gray-700 rounded-lg';
                 emptyMessage.textContent = '–í–∞—à –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å –ø—É—Å—Ç. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–µ–π—Å "Jobers" –∏–ª–∏ –∞–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥!';
                 workListElement.appendChild(emptyMessage);
            }

            workerInventory.forEach(worker => {
                const colorClass = getRarityColorClass(worker.rarity);
                const isActive = worker.isActive;
                const toggleText = isActive ? '–î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å' : '–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å';
                const toggleClass = isActive 
                    ? 'bg-red-600 hover:bg-red-700'
                    : 'bg-green-600 hover:bg-green-700';
                
                const sellPrice = calculateSellPrice(worker.income);
                const sellText = `–ü—Ä–æ–¥–∞—Ç—å (${formatCurrency(sellPrice)})`;
                const sellClass = 'bg-yellow-600 hover:bg-yellow-700';

                const workerCard = document.createElement('div');
                workerCard.className = 'flex items-center justify-between bg-gray-700 p-4 rounded-lg shadow-md mb-3 flex-wrap sm:flex-nowrap';
                workerCard.innerHTML = `
                    <div class="w-full sm:w-2/3 mb-2 sm:mb-0">
                        <p class="text-lg font-bold ${colorClass}">${worker.name}</p>
                        <p class="text-xl font-bold text-white">${worker.income} ‚ÇΩ/—Å–µ–∫</p>
                        <p class="text-xs text-gray-400 mt-1">
                            ${worker.lore}
                        </p>
                    </div>
                    <div class="w-full sm:w-1/3 text-right flex flex-col space-y-2 sm:space-y-1">
                        <p class="text-xs ${isActive ? 'text-green-400' : 'text-red-400'}">${isActive ? '–ê–ö–¢–ò–í–ï–ù' : '–ù–ï –ê–ö–¢–ò–í–ï–ù'}</p>
                        <button class="worker-toggle-btn px-4 py-2 text-sm rounded-lg font-semibold text-white transition ${toggleClass}"
                                data-id="${worker.id}">
                            ${toggleText}
                        </button>
                        <button class="worker-sell-btn px-4 py-2 text-sm rounded-lg font-semibold text-white transition ${sellClass}"
                                data-id="${worker.id}" data-name="${worker.name}" data-price="${sellPrice}">
                            ${sellText}
                        </button>
                    </div>
                `;
                workListElement.appendChild(workerCard);
            });
            
            // Attach toggle listener
            document.querySelectorAll('.worker-toggle-btn').forEach(button => {
                button.removeEventListener('click', handleWorkerToggleClick);
                button.addEventListener('click', handleWorkerToggleClick);
            });
            
            // Attach sell listener
            document.querySelectorAll('.worker-sell-btn').forEach(button => {
                button.removeEventListener('click', handleSellWorkerClick);
                button.addEventListener('click', handleSellWorkerClick);
            });


            // --- 3. –†—É—á–Ω—ã–µ –†–∞–±–æ—Ç—ã (–ö—É–ª–¥–∞—É–Ω) ---
            const manualTitle = document.createElement('h3');
            manualTitle.className = 'text-lg font-bold text-indigo-400 mb-3 mt-6 border-b border-gray-700 pb-1';
            manualTitle.textContent = '–†—É—á–Ω—ã–µ –†–∞–±–æ—Ç—ã (–ö—É–ª–¥–∞—É–Ω)';
            workListElement.appendChild(manualTitle);
            
            // –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Ä–∞–±–æ—Ç, —á—Ç–æ–±—ã –æ–±–Ω–æ–≤–ª—è—Ç—å –µ–≥–æ –æ—Ç–¥–µ–ª—å–Ω–æ
            const jobListContainer = document.createElement('div');
            jobListContainer.id = 'manual-job-list-container';
            workListElement.appendChild(jobListContainer);
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä —Ä–∞–±–æ—Ç
            _renderJobsList(jobListContainer);
            
            // --- 4. –ö–≤–µ—Å—Ç—ã ---
            const questTitle = document.createElement('h3');
            questTitle.className = 'text-lg font-bold text-indigo-400 mb-3 mt-6 border-b border-gray-700 pb-1';
            questTitle.textContent = '–ö–≤–µ—Å—Ç—ã (–ó–∞–¥–∞–Ω–∏—è)';
            workListElement.appendChild(questTitle);
            
            // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –∫–≤–µ—Å—Ç–æ–≤
            QUESTS.forEach(quest => {
                const isCompleted = questProgress.completed[quest.id];
                
                let currentProgress;
                let isReadyToClaim;
                let progressText;
                
                if (quest.type === 'level') {
                    currentProgress = level;
                    isReadyToClaim = currentProgress >= quest.requirement && !isCompleted;
                    progressText = isCompleted 
                        ? '–ó–∞–≤–µ—Ä—à–µ–Ω–æ' 
                        : `–£—Ä. ${currentProgress} / –£—Ä. ${quest.requirement}`;
                } else { 
                    currentProgress = questProgress.wins;
                    isReadyToClaim = currentProgress >= quest.requirement && !isCompleted;
                    progressText = isCompleted 
                        ? '–ó–∞–≤–µ—Ä—à–µ–Ω–æ' 
                        : `${currentProgress} / ${quest.requirement} –ø–æ–±–µ–¥`;
                }

                const isLocked = level < quest.unlockLevel;

                const isDisabled = isLocked || isCompleted || !isReadyToClaim;
                
                const buttonText = isLocked
                    ? `–¢—Ä–µ–±—É–µ—Ç—Å—è –£—Ä. ${quest.unlockLevel}`
                    : (isCompleted 
                        ? '–ù–∞–≥—Ä–∞–¥–∞ –ü–æ–ª—É—á–µ–Ω–∞'
                        : (isReadyToClaim ? '–ó–ê–ë–†–ê–¢–¨ –ù–ê–ì–†–ê–î–£' : '–í –ø—Ä–æ—Ü–µ—Å—Å–µ...'));

                const buttonClass = isLocked
                    ? 'bg-red-900 text-red-300 cursor-not-allowed'
                    : (isCompleted 
                        ? 'bg-green-700 text-white cursor-default'
                        : (isReadyToClaim 
                            ? 'bg-lime-600 hover:bg-lime-700 active:bg-lime-800'
                            : 'bg-gray-600 cursor-not-allowed'));
                
                const rewardText = `${formatCurrency(quest.reward)}${quest.xpReward > 0 ? ` + ${quest.xpReward} XP` : ''}`;

                const questCard = document.createElement('div');
                questCard.className = 'flex items-center justify-between bg-gray-700 p-4 rounded-lg shadow-md mb-3';
                questCard.innerHTML = `
                    <div>
                        <p class="text-lg font-bold text-white">${quest.name}</p>
                        <p class="text-sm text-gray-400">${quest.description}</p>
                        <p class="text-xs text-yellow-400 mt-1">–ù–∞–≥—Ä–∞–¥–∞: ${rewardText}</p>
                    </div>
                    <div class="text-right">
                        <p class="text-xs ${isCompleted ? 'text-green-400' : 'text-yellow-400'} mb-1">${progressText}</p>
                        <button id="quest-btn-${quest.id}" 
                                class="quest-button px-4 py-2 text-sm rounded-lg font-semibold text-white transition ${buttonClass}"
                                data-id="${quest.id}"
                                ${isDisabled ? 'disabled' : ''}>
                            ${buttonText}
                        </button>
                    </div>
                `;
                workListElement.appendChild(questCard);
            });
            
            // Attach quest claim listener
            document.querySelectorAll('.quest-button').forEach(button => {
                button.removeEventListener('click', handleQuestClaim); 
                if (!button.disabled && button.dataset.id) {
                    button.addEventListener('click', handleQuestClaim);
                }
            });
        };
        
        /** –†–µ–Ω–¥–µ—Ä–∏—Ç —Å–ø–∏—Å–æ–∫ —Ä—É—á–Ω—ã—Ö —Ä–∞–±–æ—Ç (–≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–∑ _renderFullWorkView) */
        const _renderJobsList = (container) => {
            const now = Date.now();
            container.innerHTML = ''; // –û—á–∏—Å—Ç–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Ä–∞–±–æ—Ç
            
            MANUAL_JOBS.forEach(job => {
                const isLocked = level < job.level; 
                
                const lastRun = jobCooldowns[job.level] || 0;
                const timeRemaining = lastRun + job.cooldown - now;
                const isReady = timeRemaining <= 0;
                
                const isDisabled = isLocked || !isReady || job.salary === 0; 
                
                const buttonText = isLocked 
                    ? `–¢—Ä–µ–±—É–µ—Ç—Å—è –£—Ä. ${job.level}`
                    : (job.salary === 0 ? job.name : (isReady ? '–í–∑—è—Ç—å –†–∞–±–æ—Ç—É' : formatTimeDifference(timeRemaining)));

                const buttonClass = isLocked 
                    ? 'bg-red-900 text-red-300 cursor-not-allowed'
                    : (isDisabled 
                        ? 'bg-gray-600 cursor-not-allowed'
                        : 'bg-indigo-600 hover:bg-indigo-700 active:bg-indigo-800');

                const levelClass = job.level <= 5 ? 'text-green-400' : 'text-yellow-400';
                
                const jobCard = document.createElement('div');
                jobCard.className = 'flex items-center justify-between bg-gray-700 p-4 rounded-lg shadow-md mb-3';
                jobCard.innerHTML = `
                    <div>
                        <p class="text-lg font-bold text-white">${job.name} (–£—Ä. ${job.level})</p>
                        <p class="text-sm ${levelClass}">–ó–∞—Ä–ø–ª–∞—Ç–∞: ${formatCurrency(job.salary)} <span class="text-xs text-indigo-300 ml-2">+${job.xpReward} XP</span></p>
                    </div>
                    <div class="text-right">
                        ${!isLocked ? `<p id="job-cooldown-text-${job.level}" class="text-xs text-gray-400 mb-1">–ö—É–ª–¥–∞—É–Ω: ${formatTimeDifference(job.cooldown)}</p>` : `<p class="text-xs text-red-400 mb-1">–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ</p>`}
                        <button id="job-btn-${job.level}" 
                                class="manual-job-button px-4 py-2 text-sm rounded-lg font-semibold text-white transition ${buttonClass}"
                                data-level="${job.level}"
                                ${isDisabled ? 'disabled' : ''}>
                            ${buttonText}
                        </button>
                    </div>
                `;
                container.appendChild(jobCard);
            });
            
            // Re-attach event listeners after initial render
            document.querySelectorAll('.manual-job-button').forEach(button => {
                button.removeEventListener('click', handleJobClick);
                if (!button.disabled) {
                    button.addEventListener('click', handleJobClick);
                }
            });
        };
        
        /** –û–±–Ω–æ–≤–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ —Ç–∞–π–º–µ—Ä—ã —Ä—É—á–Ω—ã—Ö —Ä–∞–±–æ—Ç (–í–´–ó–´–í–ê–ï–¢–°–Ø –ö–ê–ñ–î–£–Æ –°–ï–ö–£–ù–î–£) */
        const updateWorkViewTimers = () => {
            if (currentView !== 'WORK') return;
            
            const now = Date.now();
            
            document.querySelectorAll('.manual-job-button').forEach(button => {
                const levelId = parseInt(button.dataset.level);
                const job = MANUAL_JOBS.find(j => j.level === levelId);
                
                if (!job || level < job.level) return; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–ª–∏ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ

                const lastRun = jobCooldowns[job.level] || 0;
                const timeRemaining = lastRun + job.cooldown - now;
                const isReady = timeRemaining <= 0;
                
                const isDisabled = level < job.level || !isReady || job.salary === 0; 
                
                const buttonText = level < job.level 
                    ? `–¢—Ä–µ–±—É–µ—Ç—Å—è –£—Ä. ${job.level}`
                    : (job.salary === 0 ? job.name : (isReady ? '–í–∑—è—Ç—å –†–∞–±–æ—Ç—É' : formatTimeDifference(timeRemaining)));

                const buttonClass = level < job.level 
                    ? 'bg-red-900 text-red-300 cursor-not-allowed'
                    : (isDisabled 
                        ? 'bg-gray-600 cursor-not-allowed'
                        : 'bg-indigo-600 hover:bg-indigo-700 active:bg-indigo-800');

                // 1. –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏
                if (button.textContent !== buttonText) {
                    button.textContent = buttonText;
                }
                
                // 2. –û–±–Ω–æ–≤–ª—è–µ–º –∫–ª–∞—Å—Å –∫–Ω–æ–ø–∫–∏, –µ—Å–ª–∏ –æ–Ω –∏–∑–º–µ–Ω–∏–ª—Å—è (–≤–∫–ª/–≤—ã–∫–ª)
                if (button.classList.contains('bg-indigo-600') !== (!isDisabled && !button.classList.contains('bg-indigo-600'))) {
                    // –ü—Ä–æ—Å—Ç–∞—è –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∞ –∫–ª–∞—Å—Å–æ–≤, —á—Ç–æ–±—ã –Ω–µ —Ç—Ä–æ–≥–∞—Ç—å –ª–∏—à–Ω–µ–≥–æ
                    button.className = `manual-job-button px-4 py-2 text-sm rounded-lg font-semibold text-white transition ${buttonClass}`;
                }

                // 3. –û–±–Ω–æ–≤–ª—è–µ–º disabled —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                button.disabled = isDisabled;
                
                // 4. –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –∫—É–ª–¥–æ—É–Ω–∞
                const cooldownTextElement = document.getElementById(`job-cooldown-text-${job.level}`);
                if (cooldownTextElement) {
                     cooldownTextElement.textContent = `–ö—É–ª–¥–∞—É–Ω: ${formatTimeDifference(job.cooldown)}`;
                }
                
                // 5. –ü–æ–≤—Ç–æ—Ä–Ω–æ –ø—Ä–∏–∫—Ä–µ–ø–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫, –µ—Å–ª–∏ –æ–Ω —Å—Ç–∞–ª –¥–æ—Å—Ç—É–ø–µ–Ω
                if (isReady && !button.disabled) {
                    // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π –∏ –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π (–≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –±—É–¥–µ—Ç —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω)
                    button.removeEventListener('click', handleJobClick);
                    button.addEventListener('click', handleJobClick);
                }
            });
        };

        /** –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ç–µ–∫—É—â–µ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç UI */
        const setView = (view) => {
            currentView = view;
            
            const gameContent = document.getElementById('game-content');
            const workContent = document.getElementById('work-content');
            
            if (currentView === 'GAME') {
                gameContent.classList.remove('hidden');
                workContent.classList.add('hidden');
                gameTabButton.classList.add('border-indigo-500', 'text-white');
                workTabButton.classList.remove('border-indigo-500', 'text-white');
                workTabButton.classList.add('border-transparent', 'text-gray-400');
            } else {
                gameContent.classList.add('hidden');
                workContent.classList.remove('hidden');
                workTabButton.classList.add('border-indigo-500', 'text-white');
                gameTabButton.classList.remove('border-indigo-500', 'text-white');
                gameTabButton.classList.add('border-transparent', 'text-gray-400');
                
                // –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∞ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ü–ï–†–ï–•–û–î–ï –Ω–∞ –≤–∫–ª–∞–¥–∫—É "–†–∞–±–æ—Ç–∞"
                _renderFullWorkView(); 
            }
        };

        /** –û–±–Ω–æ–≤–ª—è–µ—Ç —ç–ª–µ–º–µ–Ω—Ç—ã UI */
        const updateUI = () => {
            if (!balanceElement) return;

            balanceElement.textContent = formatCurrency(balance);
            const xpBar = document.getElementById('xp-progress-bar');
            
            if (level >= MAX_LEVEL) {
                levelElement.textContent = `${MAX_LEVEL} (MAX)`;
                xpElement.textContent = 'MAX';
                xpBar.style.width = `100%`;
            } else {
                levelElement.textContent = level;
                const xpRequired = getRequiredXP(level);
                xpElement.textContent = `${xp} / ${xpRequired} XP`;
                
                const progress = (xp / xpRequired) * 100;
                xpBar.style.width = `${Math.min(100, progress)}%`;
            }

            betInputElement.value = betAmount;
            
            if (currentView === 'GAME') {
                multiplierElement.textContent = formatMultiplier(currentMultiplier);
                
                rocketIcon.classList.toggle('animate-pulse', gameState === 'RUNNING');
                
                if (gameState === 'IDLE' || gameState === 'CASHED_OUT') {
                    multiplierElement.classList.remove('text-red-500', 'text-yellow-500');
                    multiplierElement.classList.add('text-gray-400');
                    statusText.textContent = '–û–∂–∏–¥–∞–Ω–∏–µ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ä–∞—É–Ω–¥–∞...';
                    
                } else if (gameState === 'RUNNING') {
                    multiplierElement.classList.remove('text-red-500', 'text-gray-400');
                    if (currentMultiplier >= 2.00) {
                        multiplierElement.classList.add('text-yellow-500');
                    } else {
                        multiplierElement.classList.remove('text-yellow-500');
                    }
                    
                    statusText.textContent = '–†–∞–∫–µ—Ç–∞ –ª–µ—Ç–∏—Ç! –ñ–º–∏ –°–¢–û–ü!';
                    
                } else if (gameState === 'CRASHED') {
                    multiplierElement.classList.remove('text-yellow-500', 'text-gray-400');
                    multiplierElement.classList.add('text-red-500');
                    statusText.textContent = `–ö–†–ê–•! x${crashPoint.toFixed(2)}. –í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏ ${formatCurrency(betAmount)}!`;
                }
                
                // –õ–æ–≥–∏–∫–∞ –∫–Ω–æ–ø–∫–∏
                betInputElement.disabled = gameState === 'RUNNING';

                if (gameState === 'RUNNING') {
                    playButton.textContent = '–°–¢–û–ü (x' + currentMultiplier.toFixed(2) + ')';
                    playButton.classList.remove('bg-green-600', 'hover:bg-green-700');
                    playButton.classList.add('bg-red-600', 'hover:bg-red-700');
                    playButton.disabled = false;
                } else {
                    playButton.textContent = '–ò–ì–†–ê–¢–¨';
                    playButton.classList.remove('bg-red-600', 'hover:bg-red-700');
                    playButton.classList.add('bg-green-600', 'hover:bg-green-700');
                    playButton.disabled = isGameStarting || (betAmount > balance || betAmount <= 0) || isCaseOpening;
                }

                if (gameState === 'CASHED_OUT') {
                    const winnings = betAmount * currentMultiplier;
                    messageBox.textContent = `–£—Å–ø–µ—Ö! –í—ã –∑–∞–±—Ä–∞–ª–∏ ${formatCurrency(winnings)} –ø—Ä–∏ x${currentMultiplier.toFixed(2)}!`;
                    messageBox.classList.remove('hidden');
                    setTimeout(() => {
                        messageBox.classList.add('hidden');
                    }, 3000);
                } else if (gameState !== 'IDLE') {
                    messageBox.classList.add('hidden');
                }
            } 
            // Work view updates are handled by the timer function and explicit calls.
        };

        // --- Game Logic (Crash) ---

        /** –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –º–Ω–æ–∂–∏—Ç–µ–ª—å –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–æ—à–µ–¥—à–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ */
        const calculateMultiplier = (timeElapsedMs) => {
            // –ò–∑–º–µ–Ω–µ–Ω–æ: —É–º–µ–Ω—å—à–µ–Ω –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —Å 0.15 –¥–æ 0.05 –¥–ª—è –∑–∞–º–µ–¥–ª–µ–Ω–∏—è —Ä–æ—Å—Ç–∞ –º–Ω–æ–∂–∏—Ç–µ–ª—è
            const timeSeconds = timeElapsedMs / 1000.0;
            return 1.0 + Math.pow(timeSeconds, 1.5) * 0.05; 
        };

        /** –û—Å–Ω–æ–≤–Ω–æ–π –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª */
        const gameLoop = (timestamp) => {
            if (gameState !== 'RUNNING') {
                return;
            }

            if (!gameStartTime) {
                gameStartTime = timestamp;
            }

            const timeElapsed = timestamp - gameStartTime;

            currentMultiplier = calculateMultiplier(timeElapsed);

            // –í–∏–∑—É–∞–ª—å–Ω—ã–π –º–Ω–æ–∂–∏—Ç–µ–ª—å –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ (—á—Ç–æ–±—ã —Ä–∞–∫–µ—Ç–∞ –Ω–µ —É–ª–µ—Ç–µ–ª–∞ —Å–ª–∏—à–∫–æ–º –¥–∞–ª–µ–∫–æ)
            const visualMultiplier = Math.min(currentMultiplier, 5.00); 
            const travelRange = visualMultiplier - 1.00; 
            const maxRange = 4.00; 
            
            const percentageUp = (travelRange / maxRange) * 80; 
            
            rocketIcon.style.transform = `translateY(${Math.min(0, -percentageUp)}%)`;

            if (currentMultiplier >= crashPoint) {
                endGame('CRASHED');
                return;
            }

            updateUI();

            animationFrameId = requestAnimationFrame(gameLoop);
        };

        /** –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∏–≥—Ä—É */
        const startGame = () => {
            const bet = parseFloat(betInputElement.value);
            
            if (isNaN(bet) || bet <= 0 || bet > balance) {
                messageBox.textContent = '–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Å—Ç–∞–≤–∫–∞. –í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –æ—Ç 1 –¥–æ ' + formatCurrency(balance);
                messageBox.classList.remove('hidden');
                setTimeout(() => { messageBox.classList.add('hidden'); }, 3000);
                return;
            }

            isGameStarting = true;
            playButton.disabled = true;
            statusText.textContent = '–ó–∞–ø—É—Å–∫ —Ä–∞–∫–µ—Ç—ã...';

            rocketIcon.classList.remove('rocket-exploding'); 
            rocketIcon.style.transform = `translateY(0)`; 
            rocketIcon.style.opacity = 1; 

            setTimeout(() => {
                const r = Math.random(); 
                // –§–æ—Ä–º—É–ª–∞ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–æ—á–∫–∏ –∫—Ä–∞—Ö–∞ (–æ—Å—Ç–∞–≤–ª–µ–Ω–∞ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π, —á—Ç–æ–±—ã —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ)
                crashPoint = Math.max(1.01, 1 / (1 - r) * 0.07 + 1.0); 
                crashPoint = Math.min(crashPoint, 100.0); 

                balance -= bet;
                saveState(); 

                betAmount = bet;
                currentMultiplier = 1.00;
                gameState = 'RUNNING';
                gameStartTime = 0; 
                isGameStarting = false;
                
                updateUI();
                animationFrameId = requestAnimationFrame(gameLoop); 
            }, 1000); 
        };

        /** –ó–∞–≤–µ—Ä—à–∞–µ—Ç –∏–≥—Ä—É */
        const endGame = (reason) => {
            if (animationFrameId) {
                cancelAnimationFrame(animationFrameId);
                animationFrameId = null;
            }
            
            if (level < MAX_LEVEL) {
                 xp += XP_PER_GAME;
            }
            checkLevelUp();
            
            if (reason === 'CASHED_OUT') {
                const winnings = betAmount * currentMultiplier;
                balance += winnings; 
                
                questProgress.wins += 1;

                gameState = 'CASHED_OUT';
            } else {
                gameState = 'CRASHED';
                rocketIcon.classList.add('rocket-exploding');
                
                setTimeout(() => {
                    rocketIcon.style.opacity = 0; 
                }, 500);
            }

            saveState(); 

            updateUI();
            
            setTimeout(() => {
                currentMultiplier = 1.00;
                gameState = 'IDLE';
                rocketIcon.style.transform = `translateY(0)`; 
                rocketIcon.style.opacity = 1;
                rocketIcon.classList.remove('rocket-exploding');
                updateUI();
            }, 3000); 
        };

        /** –î–µ–π—Å—Ç–≤–∏–µ –∏–≥—Ä–æ–∫–∞: –∑–∞–±—Ä–∞—Ç—å –≤—ã–∏–≥—Ä—ã—à */
        const cashOut = () => {
            if (gameState === 'RUNNING' && currentMultiplier > 1.00) {
                endGame('CASHED_OUT');
            }
        };
        
        // --- Worker/Job Logic (Work) ---
        
        /** –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ —Ä—É—á–Ω–æ–π —Ä–∞–±–æ—Ç–µ */
        const handleJobClick = (event) => {
            const levelId = parseInt(event.target.dataset.level);
            const job = MANUAL_JOBS.find(j => j.level === levelId);

            if (!job || level < job.level) return; 

            const now = Date.now();
            const lastRun = jobCooldowns[job.level] || 0;
            const timeRemaining = lastRun + job.cooldown - now;

            if (timeRemaining > 0) {
                 messageBox.textContent = `–ü–æ–¥–æ–∂–¥–∏—Ç–µ! –î–æ—Å—Ç—É–ø–Ω–æ —á–µ—Ä–µ–∑ ${formatTimeDifference(timeRemaining)}`;
                 messageBox.classList.remove('hidden');
                 setTimeout(() => { messageBox.classList.add('hidden'); }, 3000);
                 return;
            }
            
            balance += job.salary;
            if (level < MAX_LEVEL) { 
                xp += job.xpReward; 
            }
            checkLevelUp();
            
            jobCooldowns[levelId] = now; 

            saveState(); 

            messageBox.textContent = `–†–∞–±–æ—Ç–∞ "${job.name}" –≤—ã–ø–æ–ª–Ω–µ–Ω–∞! –ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ ${formatCurrency(job.salary)}. –ü–æ–ª—É—á–µ–Ω–æ ${job.xpReward} XP.`;
            messageBox.classList.remove('hidden');
            
            // –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã, –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ —Ç–∞–π–º–µ—Ä—ã
            setTimeout(() => {
                messageBox.classList.add('hidden');
                if (currentView === 'WORK') updateWorkViewTimers(); 
            }, 3000);
        };

        /** –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç–Ω–∏–∫–∞ */
        const handleWorkerToggleClick = (event) => {
             const workerId = event.target.dataset.id;
             toggleWorkerActive(workerId);
        };

        /** –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ –∫–Ω–æ–ø–∫–µ "–ü—Ä–æ–¥–∞—Ç—å" */
        const handleSellWorkerClick = (event) => {
            const workerId = event.target.dataset.id;
            const workerName = event.target.dataset.name;
            const sellPrice = parseInt(event.target.dataset.price);

            currentWorkerActionId = workerId;

            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
            workerActionTitle.textContent = '–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ü—Ä–æ–¥–∞–∂–∏';
            workerActionMessage.innerHTML = `
                –í—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ö–æ—Ç–∏—Ç–µ –ø—Ä–æ–¥–∞—Ç—å —Ä–∞–±–æ—Ç–Ω–∏–∫–∞ 
                <span class="font-extrabold text-yellow-400">"${workerName}"</span>?
                <br>
                –í—ã –ø–æ–ª—É—á–∏—Ç–µ: 
                <span class="text-2xl font-black text-yellow-400">${formatCurrency(sellPrice)}</span>.
            `;
            workerActionButton.textContent = '–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –ü—Ä–æ–¥–∞–∂—É';
            workerActionButton.className = 'px-6 py-3 bg-yellow-600 text-white font-bold rounded-lg hover:bg-yellow-700 transition';
            
            // –û—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            workerActionModal.classList.remove('hidden');
        };
        
        /** –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏—è (–ü—Ä–æ–¥–∞–∂–∞) */
        const handleActionConfirm = () => {
            if (currentWorkerActionId) {
                // –ü–æ—Å–∫–æ–ª—å–∫—É –≤ —ç—Ç–æ–º –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ —É –Ω–∞—Å –ø–æ–∫–∞ —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ –¥–µ–π—Å—Ç–≤–∏–µ (–ü—Ä–æ–¥–∞–∂–∞),
                // –º—ã –≤—ã–∑—ã–≤–∞–µ–º sellWorker. –í –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—ã–ª –±—ã switch/case.
                sellWorker(currentWorkerActionId);
            }
        };


        
        // --- Quest Logic ---

        /** –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–∞–≥—Ä–∞–¥—ã –∑–∞ –∫–≤–µ—Å—Ç */
        const handleQuestClaim = (event) => {
            const questId = parseInt(event.target.dataset.id);
            const quest = QUESTS.find(q => q.id === questId);

            if (!quest) return;
            
            const isCompleted = questProgress.completed[questId];
            let isReadyToClaim = false;
            let reqText;

            if (quest.type === 'level') {
                isReadyToClaim = level >= quest.requirement && !isCompleted;
                reqText = `–£—Ä. ${level}/${quest.requirement}`;
            } else { 
                isReadyToClaim = questProgress.wins >= quest.requirement && !isCompleted;
                reqText = `${questProgress.wins}/${quest.requirement} –ø–æ–±–µ–¥`;
            }


            if (!isReadyToClaim) {
                messageBox.textContent = `–ö–≤–µ—Å—Ç –µ—â–µ –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω. –¢–µ–∫—É—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å: ${reqText}.`;
                messageBox.classList.remove('hidden');
                setTimeout(() => { messageBox.classList.add('hidden'); }, 3000);
                return;
            }
            
            balance += quest.reward;
            
            if (quest.xpReward > 0 && level < MAX_LEVEL) {
                xp += quest.xpReward;
                checkLevelUp(); 
            }
            
            questProgress.completed[questId] = true;
            
            saveState();

            const rewardMessage = `${formatCurrency(quest.reward)}${quest.xpReward > 0 ? ` –∏ ${quest.xpReward} XP` : ''}`;

            messageBox.textContent = `üéÅ –ö–≤–µ—Å—Ç "${quest.name}" –≤—ã–ø–æ–ª–Ω–µ–Ω! –í—ã –ø–æ–ª—É—á–∏–ª–∏ ${rewardMessage}!`;
            messageBox.classList.remove('hidden');
            
            setTimeout(() => {
                messageBox.classList.add('hidden');
                if (currentView === 'WORK') _renderFullWorkView(); // –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∞ –∫–≤–µ—Å—Ç–æ–≤
            }, 3000);
        };


        // --- Event Handlers ---

        /** –ì–ª–∞–≤–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–ò–ì–†–ê–¢–¨/–°–¢–û–ü" */
        const handlePlayStopClick = () => {
            if (gameState === 'RUNNING') {
                cashOut();
            } else if (gameState === 'IDLE' || gameState === 'CASHED_OUT' || gameState === 'CRASHED') {
                startGame();
            }
        };
        
        /** –ó–∞–ø—É—Å–∫–∞–µ—Ç —Ç–∞–π–º–µ—Ä –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫—É–ª–¥–æ—É–Ω–æ–≤ –≤ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–∏ "–†–∞–±–æ—Ç–∞" */
        const startWorkViewTimer = () => {
             // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ —Ç–∞–π–º–µ—Ä—ã —Ä—É—á–Ω—ã—Ö —Ä–∞–±–æ—Ç –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
             setInterval(() => {
                 if (currentView === 'WORK') {
                     updateWorkViewTimers();
                 }
             }, 1000);
        };

        // --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞ ---
        document.addEventListener('DOMContentLoaded', () => {
            // –ü—Ä–∏—Å–≤–∞–∏–≤–∞–µ–º UI —ç–ª–µ–º–µ–Ω—Ç—ã
            balanceElement = document.getElementById('balance-display');
            levelElement = document.getElementById('level-display');
            xpElement = document.getElementById('xp-display');

            multiplierElement = document.getElementById('multiplier-display');
            betInputElement = document.getElementById('bet-input');
            playButton = document.getElementById('play-button');
            statusText = document.getElementById('status-text');
            messageBox = document.getElementById('message-box');
            rocketIcon = document.getElementById('rocket-icon-wrapper'); 
            
            gameTabButton = document.getElementById('game-tab');
            workTabButton = document.getElementById('work-tab');
            workListElement = document.getElementById('work-list');
            caseOpeningModal = document.getElementById('case-opening-modal');
            
            // –≠–ª–µ–º–µ–Ω—Ç—ã –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –¥–µ–π—Å—Ç–≤–∏–π —Å —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–º
            workerActionModal = document.getElementById('worker-action-modal');
            workerActionTitle = document.getElementById('worker-action-title');
            workerActionMessage = document.getElementById('worker-action-message');
            workerActionButton = document.getElementById('worker-action-button');
            const workerActionCancelButton = document.getElementById('worker-action-cancel');
            
            // –≠–ª–µ–º–µ–Ω—Ç—ã –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —à–∞–Ω—Å–æ–≤
            rarityModal = document.getElementById('rarity-modal');


            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏ –∑–∞–ø—É—Å–∫–∞–µ–º —Ü–∏–∫–ª—ã
            loadState();
            startPassiveIncomeLoop();
            startWorkViewTimer(); 

            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Event Listeners
            playButton.addEventListener('click', handlePlayStopClick);
            gameTabButton.addEventListener('click', () => setView('GAME'));
            workTabButton.addEventListener('click', () => setView('WORK'));
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Event Listeners –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –¥–µ–π—Å—Ç–≤–∏–π
            workerActionButton.addEventListener('click', handleActionConfirm);
            workerActionCancelButton.addEventListener('click', () => {
                workerActionModal.classList.add('hidden');
                currentWorkerActionId = null;
            });
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Event Listener –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —à–∞–Ω—Å–æ–≤
            document.getElementById('close-rarity-modal-btn').addEventListener('click', () => {
                 rarityModal.classList.add('hidden');
            });


            betInputElement.addEventListener('input', (e) => {
                let value = parseFloat(e.target.value);
                if (isNaN(value) || value < 1) {
                    value = 1;
                }
                value = Math.min(value, balance);
                e.target.value = Math.floor(value); 
                betAmount = Math.floor(value);
                updateUI();
            });
            
            // –ù–∞—á–∞–ª—å–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ UI
            betInputElement.value = betAmount;
            setView('GAME'); 
            updateUI(); // –ü–µ—Ä–≤–∏—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
        });
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0d0e12; 
        }
        .text-shadow-custom {
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.8), 0 0 20px rgba(0, 255, 255, 0.5);
        }
        .multiplier-font {
            font-size: 5rem;
            line-height: 1;
            font-weight: 800;
        }
        @media (max-width: 640px) {
            .multiplier-font {
                font-size: 3.5rem;
            }
        }
        
        /* Keyframes for the explosion effect */
        @keyframes explode {
            0% { transform: scale(1) rotate(0deg); opacity: 1; }
            50% { transform: scale(2.5) rotate(10deg); opacity: 0.5; filter: drop-shadow(0 0 10px red); }
            100% { transform: scale(3) rotate(-10deg); opacity: 0; filter: drop-shadow(0 0 20px yellow); }
        }

        /* Explosion class applied to the rocket wrapper */
        .rocket-exploding {
            animation: explode 0.5s ease-out forwards;
        }

        /* General transition for smooth movement (used for translateY in JS) */
        #rocket-icon-wrapper {
            transition: transform 0.1s linear, opacity 0.5s;
            will-change: transform; 
        }

        /* Case Opening Animation */
        @keyframes bounce-in {
            0% { transform: scale(0.5); opacity: 0; }
            50% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); }
        }
        .animate-bounce-in {
            animation: bounce-in 0.5s ease-out forwards;
        }
        
        /* –ù–û–í–û–ï: –ê–Ω–∏–º–∞—Ü–∏—è —Ç—Ä—è—Å–∫–∏ –¥–ª—è –Ω–µ–≤–µ—Ä–Ω–æ–≥–æ –ø—Ä–æ–º–æ–∫–æ–¥–∞ */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        .animate-shake {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
            transform: translate3d(0, 0, 0);
            backface-visibility: hidden;
            perspective: 1000px;
        }

    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <!-- Case Opening Modal (Hidden by default) -->
    <div id="case-opening-modal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 p-4">
        <div class="bg-gray-800 p-8 rounded-xl max-w-sm w-full text-center shadow-2xl border border-indigo-600">
            <h2 class="text-3xl font-extrabold text-white mb-6">
                üéâ –ù–û–í–´–ô –†–ê–ë–û–¢–ù–ò–ö!
            </h2>
            <div id="case-result-content">
                <!-- Content generated by JS animation -->
            </div>
        </div>
    </div>
    
    <!-- Worker Action Modal (–ü—Ä–æ–¥–∞–∂–∞/–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ) -->
    <div id="worker-action-modal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 p-4">
        <div class="bg-gray-800 p-8 rounded-xl max-w-sm w-full text-center shadow-2xl border border-yellow-600">
            <h2 id="worker-action-title" class="text-3xl font-extrabold text-white mb-4">
                <!-- Title generated by JS -->
            </h2>
            <p id="worker-action-message" class="text-lg text-gray-300 mb-6">
                <!-- Message generated by JS -->
            </p>
            <div class="flex justify-center space-x-4">
                <button id="worker-action-cancel" class="px-6 py-3 bg-gray-600 text-white font-bold rounded-lg hover:bg-gray-700 transition">
                    –û—Ç–º–µ–Ω–∞
                </button>
                <button id="worker-action-button" class="px-6 py-3 bg-yellow-600 text-white font-bold rounded-lg hover:bg-yellow-700 transition">
                    <!-- Text generated by JS -->
                </button>
            </div>
        </div>
    </div>
    
    <!-- Rarity Chances Modal (–ù–û–í–û–ï –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û) -->
    <div id="rarity-modal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 p-4">
        <div class="bg-gray-800 p-8 rounded-xl max-w-sm w-full shadow-2xl border border-yellow-600">
            <h2 class="text-3xl font-extrabold text-white mb-4 text-center">
                üìä –®–∞–Ω—Å—ã –í—ã–ø–∞–¥–µ–Ω–∏—è –†–∞–±–æ—Ç–Ω–∏–∫–æ–≤
            </h2>
            <div id="rarity-result-content" class="mb-6 space-y-2">
                <!-- Content generated by openRarityModal -->
            </div>
            <button id="close-rarity-modal-btn" class="w-full px-6 py-3 bg-indigo-600 text-white font-bold rounded-lg hover:bg-indigo-700 transition">
                –ó–∞–∫—Ä—ã—Ç—å
            </button>
        </div>
    </div>


    <!-- Main Game Container -->
    <div id="game-container" class="w-full max-w-md bg-gray-800 shadow-2xl rounded-xl p-6 border border-gray-700">
        
        <!-- Header: Balance, Level & Title -->
        <header class="mb-6 pb-3 border-b border-gray-700">
            <h1 class="text-2xl font-extrabold text-white mb-2">
                üöÄ <span class="text-indigo-400">CRASH</span> –ö–∞–∑–∏–Ω–æ
            </h1>
            <div class="flex justify-between items-end">
                <!-- Balance -->
                <div class="text-left">
                    <p class="text-sm text-gray-400">–ë–∞–ª–∞–Ω—Å</p>
                    <p id="balance-display" class="text-xl font-bold text-yellow-400">... ‚ÇΩ</p>
                </div>

                <!-- Level & XP -->
                <div class="text-right">
                    <p class="text-sm font-bold text-green-400">–£—Ä–æ–≤–µ–Ω—å <span id="level-display">1</span></p>
                    <p id="xp-display" class="text-xs text-gray-400">0 / 20 XP</p>
                    <!-- XP Bar -->
                    <div class="w-24 h-1 bg-gray-600 rounded-full mt-1 overflow-hidden">
                        <div id="xp-progress-bar" class="h-full bg-green-500 transition-all duration-300" style="width: 0%;"></div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Tab Navigation -->
        <div class="flex border-b border-gray-700 mb-6">
            <button id="game-tab" class="flex-1 py-3 text-sm font-medium border-b-2 transition duration-150 border-indigo-500 text-white">
                –ò–≥—Ä–∞ (Crash)
            </button>
            <button id="work-tab" class="flex-1 py-3 text-sm font-medium border-b-2 transition duration-150 border-transparent text-gray-400 hover:text-white">
                –†–∞–±–æ—Ç–∞ / –ö–≤–µ—Å—Ç—ã
            </button>
        </div>

        <!-- Alert/Message Box -->
        <div id="message-box" class="hidden bg-yellow-900 text-yellow-300 p-3 rounded-lg mb-4 text-center font-semibold transition-all duration-300">
            <!-- Messages appear here -->
        </div>

        <!-- Main Content Area -->
        <div>
            
            <!-- GAME VIEW -->
            <div id="game-content">
                <!-- Game Area: Multiplier Display -->
                <div id="game-area" class="bg-gray-900 rounded-xl p-6 text-center shadow-inner mb-6 relative overflow-hidden h-64 flex flex-col justify-center items-center">
                    
                    <!-- Rocket/Multiplier Icon Wrapper (for animation) -->
                    <div id="rocket-icon-wrapper" class="absolute inset-0 flex flex-col justify-center items-center h-full w-full">
                        <div class="text-6xl transition-all duration-500 text-indigo-400">
                            <!-- Inline SVG for a Rocket -->
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-16 h-16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M4.5 16.5l-3 3h3l1.5-1.5zM21 7l-2-2m-1-1l-2 2m-1 1l2 2m-1-1l-2-2m-1-1l2 2m-1-1l-2-2M2 2l10 10m10-10l-2 2m-1-1l-2-2m-1 1l2 2m-1-1l-2-2m-1 1l2 2m-1-1l-2-2M7.5 19.5l-3-3h3l1.5 1.5zM12 2v10m6-6l-4 4-2-2-4 4"/>
                                <path d="M12 2v20M2 12h20M15 9l-3 3-3-3M9 15l3-3 3 3"/>
                            </svg>
                        </div>
                    </div>
                    
                    <!-- Multiplier Value (always stays centered) -->
                    <div id="multiplier-display" class="multiplier-font text-white transition-all duration-300 text-shadow-custom relative z-10">
                        1.00x
                    </div>
                    
                    <!-- Status Text -->
                    <p id="status-text" class="text-sm text-gray-500 mt-2 relative z-10">–û–∂–∏–¥–∞–Ω–∏–µ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ä–∞—É–Ω–¥–∞...</p>
                </div>

                <!-- Bet Controls -->
                <div class="space-y-4">
                    
                    <!-- Bet Input -->
                    <div>
                        <label for="bet-input" class="block text-sm font-medium text-gray-400 mb-1">
                            –°—É–º–º–∞ —Å—Ç–∞–≤–∫–∏ (‚ÇΩ)
                        </label>
                        <input type="number" id="bet-input" value="10" min="1" max="100000"
                            class="w-full p-3 rounded-lg bg-gray-700 text-white border border-gray-600 focus:ring-indigo-500 focus:border-indigo-500 transition duration-150"
                            inputmode="numeric" />
                    </div>

                    <!-- Play/Stop Button -->
                    <button id="play-button" 
                            class="w-full p-4 rounded-xl text-white font-bold text-xl uppercase shadow-lg transition duration-200 
                                bg-green-600 hover:bg-green-700 active:bg-green-800 disabled:bg-gray-600 disabled:shadow-none"
                            disabled>
                        –ò–ì–†–ê–¢–¨
                    </button>
                </div>
            </div>
            
            <!-- WORK VIEW (Jobs and Quests) -->
            <div id="work-content" class="hidden">
                 <p class="text-sm text-gray-400 mb-4">
                     –í—ã–ø–æ–ª–Ω—è–π—Ç–µ —Ä–∞–±–æ—Ç—É, –æ—Ç–∫—Ä—ã–≤–∞–π—Ç–µ –∫–µ–π—Å—ã —Å –†–∞–±–æ—Ç–Ω–∏–∫–∞–º–∏ –∏ –≤—ã–ø–æ–ª–Ω—è–π—Ç–µ –∑–∞–¥–∞–Ω–∏—è.
                 </p>
                 <div id="work-list" class="space-y-3">
                     <!-- Content generated by _renderFullWorkView / updateWorkViewTimers -->
                     <div class="text-center text-gray-500 p-4">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</div>
                 </div>
            </div>
            
        </div>
    </div>
</body>
</html>

